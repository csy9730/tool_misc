# uclinux与ucos区别

倩倩 

2017年11月20日 16:26

23905次阅读

　　嵌入式系统是以嵌入式计算机为核心，面向用户、面向产品、面向应用，软硬件可裁减的，适用于对功能、可靠性、体积、成本、功耗等综合性能有严格要求的计算机系统。随着嵌入式系统的广泛应用，传统的前/后台程序开发机制已经不能满足日益复杂和荷记得的实现要求，因而现场常常采用嵌入式产时操作系统PROS（Real [TI](http://bbs.elecfans.com/zhuti_715_1.html)me Opera[TI](http://bbs.elecfans.com/zhuti_715_1.html)on System）开发实时多任务系统。嵌入式实时操作系统一般可以提供多任务的任务调度、时间管理、任务间通信和同步以及内存管理MMU（Memory Manager Unit）等重要服务，使得嵌入式应用程序易于设计和扩展。采用RTOS可以使嵌入式产品更可靠、开发周期更短。在嵌入式应用中使用RTOS已经成为当前嵌入式应用的一个热点。

　　完成简单功能的嵌入式系统一般不需要操作系统。如，以前许多MCS51系列单片机组成的小系统就只是利用软件实现简单的控制环路；但是随着所谓后PC时代的来临，嵌入式系统设计日趋复杂，嵌入式操作系统就必不可少了。


　　嵌入式RTOS在系统实时高效性、硬件的相关依赖性、软件固化以及应用的专业性等方面具有较为突出的优势。一般而言，嵌入式操作系统不同于一般意义的计算机操作系统，它有占用空间小、执行效率高、方便进行个性化定制和软件要求固化存储等特点。

　　UC/OS和uClinux操作系统是用两种性能优良、源码公开且被广泛应用的免费嵌入式操作系统，可以作为研究实时操作系统和非实时操作系统的典范。

## 　　**uC/OS**

　　uC/OS II（Micro Control Opera[TI](http://bbs.elecfans.com/zhuti_715_1.html)on System Two）是一个可以基于ROM运行的、可裁减的、抢占式、实时多任务内核，具有高度可移植性，特别适合于微处理器和控制器，是和很多商业操作系统性能相当的实时操作系统（RTOS）。为了提供最好的移植性能，uC/OS II最大程度上使用ANSI C语言进行开发，并且已经移植到近40多种处理器体系上，涵盖了从8位到64位各种CPU（包括DSP）。

　　uC/OS II可以简单的视为一个多任务调度器，在这个任务调度器之上完善并添加了和多任务操作系统相关的系统服务，如信号量、邮箱等。其主要特点有公开源代码，代码结构清晰、明了，注释详尽，组织有条理，可移植性好，可裁剪，可固化。内核属于抢占式，最多可以管理60个任务。从1992年开始，由于高度可靠性、移植性和安全性，uC/OS II已经广泛使用在从照相机到航空电子产品的各种应用中。

　　μC/OS-II实时多任务操作系统内核被广泛应用于微处理器、微控制器和数字信号处理器。 μC/OS-II 的前身是μC/OS，最早出自于1992 年美国嵌入式系统专家Jean J.Labrosse 在《嵌入式系统编程》杂志的5 月和6 月刊上刊登的文章连载，并把μC/OS 的源码发布在该杂志的BBS 上。

　　[![uclinux与ucos区别](http://www.elecfans.com/uploads/allimg/171120/2755783-1G120162J2338.png)](http://www.elecfans.com/uploads/allimg/171120/2755783-1G120162J2338.png)

## 　　**uCLinux**

　　uCLinux表示Micro-Control Linux，即“微控制器领域中的Linux系统”，是Lineo公司的主打产品，同时也是开放源码的嵌入式Linux的典范之作。uCLinux主要是针对目标处理器没有存储管理单元MMU（Memory Management Unit）的嵌入式系统而设计的。它已经被成功地移植到了很多平台上。由于没有MMU，其多任务的实现需要一定技巧。

　　uClinux从Linux 2.0/2.4内核派生而来，沿袭了Linux的绝大部分特性。它通常用于具有很少内存或Flash的嵌入式操作系统。在GNU通用许可证的保证下，运行uClinux操作系统的用户可以使用几乎所有的Linux API函数。由于经过了裁剪和优化，它形成了一个高度优化，代码紧凑的嵌入式Linux。

　　它具有体积小、稳定、良好的移植性、优秀的网络功能、完备的对各种文件系统的支持，以及丰富的API函数等优点。uClinux与Linux在兼容性方面表现出色，uClinux除了不能实现fork（）外，其余uClinux的API函数与标准Linux完全相同。

　　[![uclinux与ucos区别](http://www.elecfans.com/uploads/allimg/171120/2755783-1G120162PQ33.png)](http://www.elecfans.com/uploads/allimg/171120/2755783-1G120162PQ33.png)

## 　　**两种嵌入式操作系统主要性能比较**

　　嵌入式操作系统是嵌入式系统软硬件资源的控制中心，它以尽量合理的有效方法组织多个用户共享嵌入式系统的各种资源。其中用户指的是系统程序之上的所有软件。所谓合理有效的方法，指的就是操作系统如何协调并充分利用硬件资源来实现多任务。复杂的操作系统都支持文件系统，方便组织文件并易于对其规范化操作。

　　嵌入式操作系统还有一个特点就是针对不同的平台，系统不是直接可用的，一般需要经过针对专门平台的移植操作系统才能正常工作。进程调度、文件系统支持和系统移植是在嵌入式操作系统实际应用中最常见的问题，下文就从这几个角度入手对uc/os和uclinux进行分析比较。

## 　　**进程调度**

　　任务调度主要是协调任务对计算机系统内资源（如内存、i/o设备、cpu）的争夺使用。进程调度又称为cpu调度，其根本任务是按照某种原则为处于就绪状态的进程分配cpu。由于嵌入式系统中内存和i/o设备一般都和cpu同时归属于某进程，所以任务调度和进程调度概念相近，很多场合不加区分，下文中提到的任务其实就是进程的概念。

　　进程调度可分为“剥夺型调度”和“非剥夺型调度”两种基本方式。所谓“非剥夺型调度”是指：一旦某个进程被调度执行，则该进程一直执行下去直至该进程结束，或由于某种原因自行放弃cpu进入等待状态，才将cpu重新分配给其他进程。所谓“剥夺型调度”是指：一旦就绪状态中出现优先权更高的进程，或者运行的进程已用满了规定的时间片时，便立即剥夺当前进程的运行（将其放回就绪状态），把cpu分配给其他进程。

　　作为实时操作系统，uc/os是采用的可剥夺型实时多任务内核。可剥夺型的实时内核在任何时候都运行就绪了的最高优先级的任务。uc/os中最多可以支持64个任务，分别对应优先级0~63，其中0为最高优先级。调度工作的内容可以分为两部分：最高优先级任务的寻找和任务切换。

　　其最高优先级任务的寻找是通过建立就绪任务表来实现的。uc/os中的每一个任务都有独立的堆栈空间，并有一个称为任务控制块tcb（task control block）数据结构，其中第一个成员变量就是保存的任务堆栈指针。任务调度模块首先用变量ostcbhighrdy记录当前最高级就绪任务的tcb地址，然后调用os_task_sw（）函数来进行任务切换。

　　uclinux的进程调度沿用了linux的传统，系统每隔一定时间挂起进程，同时系统产生快速和周期性的时钟计时中断，并通过调度函数（定时器处理函数）决定进程什么时候拥有它的时间片。然后进行相关进程切换，这是通过父进程调用fork函数生成子进程来实现的。

　　uclinux系统fork调用完成后，要么子进程代替父进程执行（此时父进程已经sleep），直到子进程调用exit退出；要么调用exec执行一个新的进程，这个时候产生可执行文件的加载，即使这个进程只是父进程的拷贝，这个过程也不可避免。当子进程执行exit或exec后，子进程使用wakeup把父进程唤醒，使父进程继续往下执行。

　　uclinux由于没有mmu管理存储器，其对内存的访问是直接的，所有程序中访问的地址都是实际的物理地址。操作系统队内存空间没有保护，各个进程实际上共享一个运行空间。这就需要实现多进程时进行数据保护，也导致了用户程序使用的空间可能占用到系统内核空间，这些问题在编程时都需要多加注意，否则容易导致系统崩溃。

　　由上述分析可以得知，uc/os内核是针对实时系统的要求设计实现的，相对简单，可以满足较高的实时性要求。而uclinux则在结构上继承了标准linux的多任务实现方式，仅针对嵌入式处理器特点进行改良。其要实现实时性效果则需要使系统在实时内核的控制下运行，rt-linux就是可以实现这一个功能的一种实时内核。

## 　　**文件系统**

　　所谓文件系统是指负责存取和管理文件信息的机构，也可以说是负责文件的建立、撤销、组织、读写、修改、复制及对文件管理所需要的资源（如目录表、存储介质等）实施管理的软件部分。

　　uc/os是面向中小型嵌入式系统的，如果包含全部功能（信号量、消息邮箱、消息队列及相关函数），编译后的uc/os内核仅有6~10kb，所以系统本身并没有对文件系统的支持。但是uc/os具有良好的扩展性能，如果需要的话也可自行加入文件系统的内容。

　　uclinux则是继承了linux完善的文件系统性能。其采用的是romfs文件系统，这种文件系统相对于一般的ext2文件系统要求更少的空间。空间的节约来自于两个方面，首先内核支持romfs文件系统比支持ext2文件系统需要更少的代码，其次romfs文件系统相对简单，在建立文件系统超级块（superblock）需要更少的存储空间。romfs文件系统不支持动态擦写保存，对于系统需要动态保存的数据采用虚拟ram盘的方法进行处理（ram盘将采用ext2文件系统）。

　　uclinux还继承了linux网络操作系统的优势，可以很方便的支持网络文件系统且内嵌tcp/ip协议，这为uclinux开发网络接入设备提供了便利。

　　由两种操作系统对文件系统的支持可知，在复杂的需要较多文件处理的嵌入式系统中uclinux是一个不错的选择。而uc/os则主要适合一些控制系统。

　[![uclinux与ucos区别](http://www.elecfans.com/uploads/allimg/171120/2755783-1G120162S5I3.png)](http://www.elecfans.com/uploads/allimg/171120/2755783-1G120162S5I3.png)

## 　　**操作系统的移植**

　　嵌入式操作系统移植的目的是指使操作系统能在某个微处理器或微控制器上运行。UC/OS和uClinux都是源码公开的操作系统，且其结构化设计便于把与处理器相关的部分分离出来，所以被移植到新的处理器上是可能的。以下对两种系统的移植分别予以说明。

　　**（1）uC/OS的移植**

　　要移植uC/OS，目标处理器必须满足以下要求：

　　处理器的C编译器能产生可重入代码，且用C语言就可以打开和关闭中断；

　　*处理器支持中断，并能产生定时中断；

　　*处理器支持足够的RAM（几KB），作为多任务环境下的任务堆栈；

　　*处理器有将堆栈指针和其它CPU寄存器读出和存储到堆栈或内存中的指令。

　　在理解了处理器和C编译器的技术细节后，uC/OS的移植只需要修改与处理器相关的代码就可以了。具体有如下内容：

　　*OS_CPU.H中需要设置一个常量来标识堆栈增长方向；

　　*OS_CPU.H中需要声明几个用于开关中断和任务切换的宏；

　　*OS_CPU.H中需要针对具体处理器的字长重新定义一系列数据类型；

　　*OS_CPU_A.ASM需要改写4个汇编语言的函数；

　　*OS_CPU_C.C需要用C语言编写6个简单函数；

　　*修改主头文件INCLUDE.H，将上面的三个文件和其它的头文件加入。

　　**（2）uClinux的移植其实，**

　　uClinux是Linux针对嵌入式系统的一种改良，其结构比较复杂；相对uC/OS，uClinux的移植也复杂得多。一般而言，要移植uClinux，目标处理器除了应满足上述uC/OS应满足的条件外，还需要具有足够容量（几百KB以上）外部ROM和RAM。

## 　　**uClinux的移植大致可以分为3个层次。**

　　*结构层次的移植。如果待移植处理器的结构不同于任何已经支持的处理器结构，则需要修改linux/arch目录下相关处理器结构的文件。虽然uClinux内核代码的大部分是独立于处理器和其体系结构的，但是其最低级的代码也是特定于各个系统的。这主要表现在它们的中断处理上下文、内核映射的维护、任务上下文和初始化过程都是独特的。这些例行程序位于lunux/arch/目录下。由于Linux所支持体系结构的种类繁多，所以对一个新型的体系，其低级例程可以模仿与其相似的体系例程编写。

　　*平台层次的移植。如果待移植处理器是某种uClinux已支持体系的处理器，则需要在相关体系结构目录下建立相应目录并编写相应代码。如MC68EZ328就是基于无MMU的m68k内核的。此时的移植需要创建的linux/arch/m68knommu/platform/MC68EZ328目录下，并在其下编写跟踪程序（实现用户程序到内核函数的接口等功能）、中断控制调度程序和向量初始化程序等。

　　*板级移植。如果所用处理器已被uClinux支持，就只需要板级移植了。板级移植需要在linux/arch/？platform/中建立一个相应板的目录，再在其中建立相应的启动代码crt0_rom.s或crt0_ram.s和键接描述文档rom.ld或ram.ld就可以了。板级移植还包括驱动程序的编写和环境变量设置等内容。

## 　　**结语**

　　通过对uC/OS和uClinux的比较可以看出，这两种操作系统在应用方面各有优劣。uC/OS占用空间少、执行效率高、实时性能优良，且针对新处理器的移植相对简单。UClinux则占用空间相对较大，实时性能一般，针对新处理器的移植相对复杂。但是，uClinux具有对多种文件系统的支持能力、内嵌了TCP/IP协议，可以借鉴Linux丰富的资源，对一些复杂的应用，uClinux具有相当优势。例如，CISCO公司的2500/3000/4000路由器就是基于uClinux操作系统开发的。总之，操作系统的选择是由嵌入式系统的需求决定的。简单地说就是，小型控制系统可充分利用uC/OS小巧且实时性强的优势；如果开发PDA和互联网连接终端等较和为复杂的系统，则uClinux是不错的选择。