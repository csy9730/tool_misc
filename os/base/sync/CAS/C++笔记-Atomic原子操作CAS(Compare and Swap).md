# [C++笔记-Atomic原子操作/CAS(Compare and Swap)](https://www.cnblogs.com/gnivor/p/15919850.html)



目录

- [0. 参考资料](https://www.cnblogs.com/gnivor/p/15919850.html#0-参考资料)
- [1. 背景](https://www.cnblogs.com/gnivor/p/15919850.html#1-背景)
- \2. CAS
  - [2.1 C++的CAS方法](https://www.cnblogs.com/gnivor/p/15919850.html#21-c的cas方法)
  - [2.2 std::atomic的使用](https://www.cnblogs.com/gnivor/p/15919850.html#22-stdatomic的使用)
  - 2.3 CAS函数说明
    - [2.3.1compare_exchange_weak](https://www.cnblogs.com/gnivor/p/15919850.html#231compare_exchange_weak)
    - [2.3.2compare_exchange_strong](https://www.cnblogs.com/gnivor/p/15919850.html#232compare_exchange_strong)
    - [2.3.3例程](https://www.cnblogs.com/gnivor/p/15919850.html#233例程)
- [3. memory order](https://www.cnblogs.com/gnivor/p/15919850.html#3-memory-order)



# 0. 参考资料

> 1. C++ atomic http://www.cplusplus.com/reference/atomic/atomic/
> 2. C++ 原子操作库 std::atomic https://www.apiref.com/cpp-zh/cpp/atomic/atomic/compare_exchange.html
> 3. CAS https://www.cnblogs.com/muhe221/articles/5089918.html
> 4. c++并发编程3. CAS原语 https://zhuanlan.zhihu.com/p/56055215
> 5. C++11：原子交换函数compare_exchange_weak和compare_exchange_strong https://blog.csdn.net/feikudai8460/article/details/107035480/
> 6. 理解memory order https://blog.csdn.net/jiang4357291/article/details/110753759
> 7. C++11中的内存模型下篇 - C++11支持的几种内存模型 https://www.codedump.info/post/20191214-cxx11-memory-model-2/
> 8. 调试经验 | C++ memory order和一个相关的稳定性问题 https://juejin.cn/post/6844904096671989773
> 9. std::memory_order https://en.cppreference.com/w/cpp/atomic/memory_order
> 10. std::memory_order https://zh.cppreference.com/w/cpp/atomic/memory_order

# 1. 背景

多线程读写非线程安全的数据结构时，为了保证结果正确性，一种方式是对数据结构加锁后进行读写。为了解决加锁带来的性能损耗问题，可使用CAS。

# 2. CAS

Compare-and-Swap (CAS)是用于多线程以实现同步的原子指令。它将存储位置的内容与给定值进行比较，当它们逐位相等，才将该存储位置的内容修改为新的给定值。整个流程为一个原子操作。

## 2.1 C++的CAS方法

compare_exchange_weak
compare_exchange_strong
其位于atomic库中 http://www.cplusplus.com/reference/atomic/atomic/

## 2.2 std::atomic的使用

定义一个原子对象，以链表Node为例：

```cpp
struct Node {
  int value;
  Node *next;
};
std::atomic<Node *> list_head;
```

**atomic中的主要方法有：**

| 方法名                  | 功能                                          | 备注 |
| ----------------------- | --------------------------------------------- | ---- |
| is_lock_free            | Is lock-free                                  |      |
| store                   | Modify contained value                        |      |
| load                    | Read contained value                          |      |
| operator T              | Access contained value                        |      |
| exchange                | Access and modify contained value             |      |
| compare_exchange_weak   | Compare and exchange contained value (weak)   |      |
| compare_exchange_strong | Compare and exchange contained value (strong) |      |

## 2.3 CAS函数说明

### 2.3.1compare_exchange_weak

```cpp
bool compare_exchange_weak (T& expected, T val, memory_order sync = memory_order_seq_cst) volatile noexcept;
bool compare_exchange_weak (T& expected, T val, memory_order sync = memory_order_seq_cst) noexcept;
bool compare_exchange_weak (T& expected, T val, memory_order success, memory_order failure) volatile noexcept;
bool compare_exchange_weak (T& expected, T val, memory_order success, memory_order failure) noexcept;
```

### 2.3.2compare_exchange_strong

```cpp
bool compare_exchange_strong (T& expected, T val, memory_order sync = memory_order_seq_cst) volatile noexcept;
bool compare_exchange_strong (T& expected, T val, memory_order sync = memory_order_seq_cst) noexcept;
bool compare_exchange_strong (T& expected, T val, memory_order success, memory_order failure) volatile noexcept;
bool compare_exchange_strong (T& expected, T val, memory_order success, memory_order failure) noexcept;
```

**函数释义：**
将原子对象包含的值的内容与expected值进行比较：
-如果为true，则用`val`替换`原子对象包含的值`(类似于store)。
-如果为false，则用`原子对象包含的值`替换`expected`。

此函数直接将包含值的物理内容与预期值的内容进行比较
与`compare_exchange_strong`不同，`compare_exchange_weak`返回false时，仍然可能是`expected值`与`原子对象包含的对象`相等的情况。对于某些循环算法来说，这可能是可以接受，并且在某些平台上可能会有明显更好的性能。对于这种情况，函数返回false，但没有修改`expected`。

对于非循环算法，通常首选`compare_exchange_strong`。

**方法参数释义**
`expected`: 对一个对象的引用，该对象的值与`原子对象包含的值`进行比较，如果不匹配，该对象`可能会`被包含的值覆盖。
`val`: 当expected`原子对象包含的值`匹配时，copy val到`原子对象内包含的值`
`sync`: CAS操作的同步模式。参数类型为memory_order，为一组枚举值，其具体功能后文介绍

### 2.3.3例程

**Demo: 线程安全的无锁链表**

```cpp
// a simple global linked list:
struct Node {
  int value;
  Node *next;
};
 
class ConcurrentLinkList {
public:
  ConcurrentLinkList() { list_head = nullptr; }
 
  void append(int val) { // append an element to the list
    Node *old_head = list_head.load();
    Node *new_node = new Node{val, old_head};
 
    // equivalent to: list_head = new_node, but in a thread-safe way:
    while (!list_head.compare_exchange_weak(old_head, new_node)) {
      new_node->next = old_head;
    }
  }
 
  void clean() {
    Node *it;
    while (it = list_head) {
      list_head = it->next;
      delete it;
    }
  }
 
public:
  std::atomic<Node *> list_head;
};
```

<details style="margin: 0px; padding: 0px;"><summary style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><font color="#FF0000" style="margin: 0px; padding: 0px;">点击打开完整示例</font></b></summary><br style="margin: 0px; padding: 0px;"><pre class="highlighter-hljs code-theme-dark" data-dark-theme="true" highlighted="true" style="margin: 0px; padding: 0px; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; overflow: auto;"><code class="highlighter-hljs hljs language-cpp hljs-line-numbers" data-dark-theme="true" style="margin: 0px; padding: 1em; font-family: inherit; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; background: rgb(29, 31, 33); color: rgb(197, 200, 198); display: block; overflow-x: auto; line-height: 1.5; white-space: pre-wrap;"><table class="hljs-ln" style="margin: 0px; padding: 0px; border-collapse: collapse; border-spacing: 0px; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; word-break: break-word;"><tbody style="margin: 0px; padding: 0px;"><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="1" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-meta" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(51, 136, 170);"></span><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="2" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-meta" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(51, 136, 170);"></span><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="3" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-meta" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(51, 136, 170);"></span><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="4" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-meta" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(51, 136, 170);"></span><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="5" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="6" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="7" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-title class_" style="margin: 0px; padding: 0px; color: rgb(129, 162, 190);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="8" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="9" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="10" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="11" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="12" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-title class_" style="margin: 0px; padding: 0px; color: rgb(129, 162, 190);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="13" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="14" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-literal" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="15" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="16" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-function" style="margin: 0px; padding: 0px;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-title" style="margin: 0px; padding: 0px; color: rgb(129, 162, 190);"></span><span class="hljs-params" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></span></span><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="17" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="18" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="19" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="20" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="21" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="22" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="23" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="24" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="25" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-function" style="margin: 0px; padding: 0px;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-title" style="margin: 0px; padding: 0px; color: rgb(129, 162, 190);"></span><span class="hljs-params" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="26" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="27" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="28" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="29" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="30" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="31" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="32" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="33" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="34" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="35" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="36" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="37" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="37" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="37" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-function" style="margin: 0px; padding: 0px;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-title" style="margin: 0px; padding: 0px; color: rgb(129, 162, 190);"></span><span class="hljs-params" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="38" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="38" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="38" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="39" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="39" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="39" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="40" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="40" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="40" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="41" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="41" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="41" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="42" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="42" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="42" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="43" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="43" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="43" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="44" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="44" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="44" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="45" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="45" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="45" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="46" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="46" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="46" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="47" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="47" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="47" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="48" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="48" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="48" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="49" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="49" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="49" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-literal" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="50" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="50" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="50" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(181, 189, 104);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="51" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="51" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="51" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="52" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="52" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="52" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(181, 189, 104);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="53" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="53" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="53" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="54" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="54" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="54" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="55" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="55" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="55" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="56" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="56" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="56" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="57" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="57" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="57" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr></tbody></table></code></pre></details>



**compare_exchange_strong使用的结果**

<details style="margin: 0px; padding: 0px;"><summary style="margin: 0px; padding: 0px;"><b style="margin: 0px; padding: 0px;"><font color="#FF0000" style="margin: 0px; padding: 0px;">点击打开完整示例</font></b></summary><br style="margin: 0px; padding: 0px;"><pre class="highlighter-hljs code-theme-dark" data-dark-theme="true" highlighted="true" style="margin: 0px; padding: 0px; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; overflow: auto;"><code class="highlighter-hljs hljs language-cpp hljs-line-numbers" data-dark-theme="true" style="margin: 0px; padding: 1em; font-family: inherit; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; background: rgb(29, 31, 33); color: rgb(197, 200, 198); display: block; overflow-x: auto; line-height: 1.5; white-space: pre-wrap;"><table class="hljs-ln" style="margin: 0px; padding: 0px; border-collapse: collapse; border-spacing: 0px; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; word-break: break-word;"><tbody style="margin: 0px; padding: 0px;"><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="1" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-meta" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(51, 136, 170);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="2" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-meta" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"><span class="hljs-keyword" style="margin: 0px; padding: 0px; color: rgb(178, 148, 187);"></span><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(51, 136, 170);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="3" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="4" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="5" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="6" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="7" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="8" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-literal" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="9" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="10" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-function" style="margin: 0px; padding: 0px;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-title" style="margin: 0px; padding: 0px; color: rgb(129, 162, 190);"></span><span class="hljs-params" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="11" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="12" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(181, 189, 104);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="13" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(181, 189, 104);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="14" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(181, 189, 104);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="15" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(181, 189, 104);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="16" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-string" style="margin: 0px; padding: 0px; color: rgb(181, 189, 104);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="17" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="18" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="19" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-function" style="margin: 0px; padding: 0px;"><span class="hljs-type" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-title" style="margin: 0px; padding: 0px; color: rgb(129, 162, 190);"></span><span class="hljs-params" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="20" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="21" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="22" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="23" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="24" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="25" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="26" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="27" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="28" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-comment" style="margin: 0px; padding: 0px; color: rgb(150, 152, 150);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="29" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="30" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-built_in" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="31" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"></td></tr></tbody></table></code></pre><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"></p><pre class="highlighter-hljs code-theme-dark" data-dark-theme="true" highlighted="true" style="margin: 0px; padding: 0px; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; overflow: auto;"><code class="highlighter-hljs hljs language-ini hljs-line-numbers" data-dark-theme="true" style="margin: 0px; padding: 1em; font-family: inherit; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; background: rgb(29, 31, 33); color: rgb(197, 200, 198); display: block; overflow-x: auto; line-height: 1.5; white-space: pre-wrap;"><table class="hljs-ln" style="margin: 0px; padding: 0px; border-collapse: collapse; border-spacing: 0px; transition-duration: 0.2s; transition-property: background, font-size, border-color, border-radius, border-width, padding, margin, color; word-break: break-word;"><tbody style="margin: 0px; padding: 0px;"><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="1" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-attr" style="margin: 0px; padding: 0px;"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-literal" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="2" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-attr" style="margin: 0px; padding: 0px;"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-literal" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr><tr style="margin: 0px; padding: 0px;"><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3" style="margin: 0px; padding: 0px 14px; border: none; border-collapse: initial; min-width: initial; user-select: none; text-align: center; vertical-align: top; color: rgb(191, 191, 191); white-space: nowrap;"><div class="hljs-ln-n" data-line-number="3" style="margin: 0px; padding: 0px;"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3" style="margin: 0px; padding: initial; border: none; border-collapse: initial; min-width: initial;"><span class="hljs-attr" style="margin: 0px; padding: 0px;"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-number" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span><span class="hljs-literal" style="margin: 0px; padding: 0px; color: rgb(222, 147, 95);"></span></td></tr></tbody></table></code></pre></details>



# 3. memory order

`compare_exchange_weak`和`compare_exchange_strong`方法的参数 `sync` 表示CAS操作的同步模式，参数类型为`memory_order`，为一组枚举值，以下是枚举类型`memory_order`的所有可能值：

| value                | memory order            | description                                                  |
| -------------------- | ----------------------- | ------------------------------------------------------------ |
| memory_order_relaxed | Relaxed                 | 没有同步或顺序制约，仅对此操作要求原子性                     |
| memory_order_consume | Consume                 | 1. 对当前要读取的内存施加 release 语义（store），在代码中这条语句后面所有与这块内存有关的读写操作都无法被重排到这个操作之前 2. 在这个原子变量上施加 release 语义的操作发生之后，consume 可以保证读到所有在 release 前发生的并且与这块内存有关的写入 |
| memory_order_acquire | Acquire                 | 1. 向前保证，本线程中所有读写操作都不能重排到memory_order_acquire的load之前 2. 其他线程中所有memory_order_release的写操作都对当前线程可见 |
| memory_order_release | Release                 | 1. 向后保证，本线程中所有读写操作都不能重排到memory_order_acquire的store之后 2. 本线程中的所有写都对其他对同一atomic变量带有 memory_order_acquire的线程可见 3. 本线程中的所有写都对其他所有有依赖且consume该变量的线程可见 |
| memory_order_acq_rel | Acquire/Release         | 1. 是release+acquire的结合，前后都保证，本线程中所有读写操作既不能重排到memory_order_acquire的load之前也不能到之后 2. 其他线程的memory_order_release写在本线程写之前都是可见的 3. 本线程的的写对其他线程的memory_order_acquire读都是可见的 |
| memory_order_seq_cst | Sequentially consistent | 1. 顺序一致性 2. 如果是读取就是 acquire 语义，如果是写入就是 release 语义，如果是读取+写入就是 acquire-release 语义 3. 同时会对所有使用此 memory order 的原子操作进行同步，所有线程看到的内存操作的顺序都是一样的，就像单个线程在执行所有线程的指令一样 |

可参考这篇文章的图： https://blog.csdn.net/jiang4357291/article/details/110753759

当多个线程访问一个原子对象时，所有原子操作的行为特性：在任何其他原子操作可以访问该对象之前，每个原子操作都是在该对象上完全执行的。这保证了这些对象上没有数据竞争。
但是，每个线程可能会对原子对象本身以外的内存位置执行操作：这些其他操作可能会对其他线程产生明显的副作用。memory_order这种类型的参数允许为操作指定内存顺序(memory order)，该操作确定如何在线程之间同步这些（可能是非原子的）可见副作用。
在 C11/C++11 中，引入了六种不同的 memory order，可以让程序员在并发编程中根据自己需求尽可能降低同步的粒度，以获得更好的程序性能。这六种 order 分别是：
`relaxed, acquire, release, consume, acq_rel, seq_cst`



``` cpp
#include <atomic>
#include <thread>
#include <assert.h>
 
std::atomic<bool> x,y;
 
void thread1_fun() {
    x.store(true, memory_order_relaxed);
    y.store(true, memory_order_relaxed);
}
 
void thread2_fun() {
    while(!y.load(memory_order_relaxed));
        assert(x.load(memory_order_relaxed));
}
 
int main() {
    x=false;
    y=false;
    std::thread t1(thread1_fun);
    std::thread t2(thread2_fun);
    t1.join();
    t2.join();
    return 0;
}
```

<details data-math-rendered="true" open="" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><p style="margin: 10px auto; padding: 0px; text-indent: 0px;">结果<br style="margin: 0px; padding: 0px;">thread2_fun 内assert可能失败。 因为thread1中的x和y的store可能会重排(因为这个重排并不影响在thread1内的执行的结果)</p></details>

**Release-consume ordering 示例**

``` cpp
#include <atomic>
#include <thread>
#include <assert.h>
 
atomic<int> a;
atomic<int> b;
 
void fun1() {
  a.store(1, memory_order_relaxed);
  b.store(2, memory_order_release);
}
 
void fun2() {
    while (b.load(memory_order_consume) != 2) {
        // do nothing
    }
   assert(a == 1);
}
 
int main() {
    a=0;
    b=0;
    std::thread t1(fun1);
    std::thread t2(fun2);
    t1.join();
    t2.join();
    return 0;
}
```



333

``` cpp
#include <thread>
#include <atomic>
#include <cassert>
 
std::atomic<bool> x = {false};
std::atomic<bool> y = {false};
std::atomic<int> z = {0};
 
void write_x()
{
    x.store(true, std::memory_order_release);
}
 
void write_y()
{
    y.store(true, std::memory_order_release);
}
 
void read_x_then_y()
{
    while (!x.load(std::memory_order_acquire))
        ;
    if (y.load(std::memory_order_acquire)) {
        ++z;
    }
}
 
void read_y_then_x()
{
    while (!y.load(std::memory_order_acquire))
        ;
    if (x.load(std::memory_order_acquire)) {
        ++z;
    }
}
 
int main()
{
    std::thread a(write_x);
    std::thread b(write_y);
    std::thread c(read_x_then_y);
    std::thread d(read_y_then_x);
    a.join(); b.join(); c.join(); d.join();
    assert(z.load() != 0); 
}
```

5



``` cpp
#include <thread>
#include <atomic>
#include <cassert>
 
std::atomic<bool> x = {false};
std::atomic<bool> y = {false};
std::atomic<int> z = {0};
 
void write_x()
{
    x.store(true, std::memory_order_seq_cst);
}
 
void write_y()
{
    y.store(true, std::memory_order_seq_cst);
}
 
void read_x_then_y()
{
    while (!x.load(std::memory_order_seq_cst))
        ;
    if (y.load(std::memory_order_seq_cst)) {
        ++z;
    }
}
 
void read_y_then_x()
{
    while (!y.load(std::memory_order_seq_cst))
        ;
    if (x.load(std::memory_order_seq_cst)) {
        ++z;
    }
}
 
int main()
{
    std::thread a(write_x);
    std::thread b(write_y);
    std::thread c(read_x_then_y);
    std::thread d(read_y_then_x);
    a.join(); b.join(); c.join(); d.join();
    assert(z.load() != 0);  // 决不发生
}
```

