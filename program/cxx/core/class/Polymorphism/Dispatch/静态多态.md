# 静态多态


## 静态多态

### switch like
``` cpp

class Foo{
    int nseg;
public:

    void set_nseg(int nseg){ this->nseg = nseg;};
    double get_rate(double tm){
        if (nseg==0){
            return _get_rate_s0(tm);
        }else if (nseg==1){
            return _get_rate_s1(tm);
        }else {
            return _get_rate_s2(tm);
        }
    };
    double _get_rate_s0(double tm);
    double _get_rate_s1(double tm);
    double _get_rate_s2(double tm);
}

Foo foo;
foo.set_nseg(1);
foo.get_rate(0);

```

### 运行时多态

``` cpp
class _FooBase{
    virtual double get_rate(double tm);
};
class _Foo_s0{
    virtual double get_rate(double tm)override;
};
class _Foo_s1{
    virtual double get_rate(double tm)override;
};
class _Foo_s2{
    virtual double get_rate(double tm)override;
};

class Foo{
    int nseg;
    _FooBase* _impl=0;
public:
    void set_nseg(int nseg){ this->nseg = nseg;};
    void build(){ 
        if (nseg==0){
            _impl = new _Foo_s0();
        }else if (nseg==1){
            _impl = new _Foo_s1();
        }else {
            _impl = new _Foo_s2();
        }
    };
    double get_rate(double tm){
        return _impl->get_rate(tm);
    };
}

Foo foo;
foo.set_nseg(1);
foo.build();
foo.get_rate(0);

```

### 3
``` cpp
class _FooBase{
    virtual double get_rate(double tm);
};
class _Foo_s0{
    virtual double get_rate(double tm)override;
};
class _Foo_s1{
    virtual double get_rate(double tm)override;
};
class _Foo_s2{
    virtual double get_rate(double tm)override;
};

union _Foo_un{
    _Foo_s0 s0;
    _Foo_s1 s1;
    _Foo_s2 s2;
};


class Foo{
    int nseg;
    _FooBase* _impl=0;
    _Foo_un _un;
public:
    void set_nseg(int nseg){ this->nseg = nseg;};
    void build(){ 
        if (nseg==0){
            _impl = &_un._Foo_s0;
        }else if (nseg==1){
            _impl = &_un._Foo_s1;
        }else {
            _impl = &_un._Foo_s2;
        }
    };
    double get_rate(double tm){
        return _impl->get_rate(tm);
    };
}

Foo foo;
foo.set_nseg(1);
foo.build();
foo.get_rate(0);

```

### 双派发多态

