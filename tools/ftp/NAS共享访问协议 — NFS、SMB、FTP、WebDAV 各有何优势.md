# NAS 共享访问协议 — NFS、SMB、FTP、WebDAV 各有何优势？ 

随着智能化互联时代的来临，家中的智能设备越来越多：电视机、平板、游戏主机、电脑、手机等遍及家中各个角落，同时设备之间共享数据的需求变的越来越强烈。比如同步、备份手机上的照片和视频，在电视机上观看电脑中下载的影片、手机拍摄的视频，存储高清电影、音乐、VLOG 素材等。这时候在家中搭建一台 NAS（Network Attached  Storage：网络附属存储）存储服务器是不错的选择，在备份保障数据安全的同时给家庭娱乐带来更多方便。在企业中，NAS  也有着广泛的应用，其部署简单，扩展方便，在文件共享、容灾备份领域发挥了重要作用。

NAS 存储服务器有许多专业厂商，比如群晖（ Synology）、铁威马（TerraMaster）等，动手能力强的用户可以 DIY  硬件开源系统自己搭建。不过这些不是今天讨论的话题，今天我们来讨论一下 NAS  常见的共享访问协议：NFS、SMB、FTP、WebDav，哪些速度快，哪些兼容性好，如何选择。

### NFS

NFS（网络文件系统 Network File  System）是一种分布式文件系统协议，力求客户端主机可以访问服务器端文件，并且其过程与访问本地存储时一样，它由 Sun 公司（已被  Oracle 收购）开发，于 1984 年发布，最新版本 NFSv4.2 于 2016 年发布。NFS 基于开放网络运算远程过程调用（ONC  RPC）协议：一个开放、标准的 RFC 协议，任何人或组织都可以依据标准实现它。

NFS 通常使用在 Unix 操作系统上（比如 Solaris、AIX 及 HP-UX）和其他类 Unix 操作系统（例如 Linux 及 FreeBSD），同时在 macOS 和 Windows 系统也提供了 NFS 实现。不过在 Windows 系统上挂载 NFS  共享目录时，由于 Windows 自带的 NFS 客户端长久以来不支持 UTF-8，会致中文文件和目录显示为乱码。

NFS 的优点是内核直接支持，部署简单、运行稳定，协议简单、传输效率高。

NFS 的缺点是没有加密授权等功能，仅依靠 IP 地址或主机名来决定用户能否挂载共享目录，对具体目录和文件无法进行 ACL 权限控制（NFSv4 以前）。通常的做法是通过 Kerberos 对 NFS 进行认证及加密，不过部署配置比较麻烦。

### SMB / Samba

Samba 是 SMB/CIFS（Server Message Block / Common Internet File System）网络协议的重新实现，可以在局域网不同计算机之间进行文件、打印机等资源共享，和 NFS 功能类似。

SMB 最早是微软为自己需求设计的专用协议，用来实现微软主机之间的文件共享与打印共享，并不支持在 Linux 上运行。著名黑客、技术大牛  Andrew Tridgell 通过逆向工程，在 Linux 上实现的 SMB / CIFS 兼容协议，命名为 Samba，通过该程序实现了  Windows 和 Linux 之间的文件共享。

SMB 协议是 C/S 类型协议，客户机通过该协议可以访问服务器上的共享文件系统、打印机及其他资源。通过设置“NetBIOS over TCP/IP”，Samba 不但能与局域网络主机分享资源，还能与全世界的电脑分享资源。

SMB 的优点之一是兼容性好，在各平台获得了广泛支持，包括 Windows、Linux、macOS 等各系统挂载访问都很方便。另外 SMB 也是各种电视、电视盒子默认支持的协议，可以通过 SMB 远程播放电影、音乐和图片。

另外 SMB 提供端到端加密、安全性高，配置选项丰富，支持 ACL 并支持多种用户认证模式。

SMB 的缺点是传输效率稍低，速度不太稳定，会有波动。

### FTP

FTP（File Transfer ProtocoL）是TCP/IP应用层中的一个基础协议，通常使用 22  端口，负责将文件从一台计算机传输到另计算机，并保证文件传输的可靠性。FTP 协议的历史源远流长，第一版 FTP 协议于 1971 年发表为  RFC 114，此后经过多年的发展和完善。通常所说的 FTP 既可指 FTP 协议，也可指 FTP 应用程序。

由于 FTP 是明文传输安全性不高，后来又出现了 SFTP 和 FTPS 等加密传输。FTP 的特点之一是独立于系统用户组，只要通讯端口开启就能方便访问，所以特别适合外网共享，一些老牌共享软件就常常通过 FTP 发布下载链接。

FTP 主要用于客户端和服务器之间的文件上传和下载，并不适用于服务器上文件修改。因为 FTP 通常需要先获取远程文件的副本，然后对副本修改，最后再将修改后的文件副本上传服务器。

虽然 FTP 的简单方便、容易部署，但 FTP 的传输效率低、安全性不佳，目前并不推荐使用。

### WebDAV

基于 Web  的分布式编写和版本控制（WebDAV）是超文本传输协议（HTTP）的扩展，有利于用户间协同编辑和管理存储在万维网服务器文档。WebDAV  由互联网工程任务组的工作组在 RFC 4918 中定义。许多现代操作系统为 WebDAV 提供了内置支持。

WebDAV 除了创建、删除文件等基本功能，它还具备文件创建者管理、文件编辑过程中禁止其他用户内容覆盖的加锁功能，以及对文件内容修改的版本控制功能。

WebDAV 为实现远程文件管理，向 HTTP/1.1 中追加了以下这些方法。

- PROPFIND：获取属性
- PROPPATCH：修改属性
- MKCOL：创建集合
- COPY：复制资源及属性
- MOVE：移动资源
- LOCK：资源加锁
- UNLOCK：资源解锁

为配合扩展的方法，状态码也随之扩展。

- 102 Processing：可正常处理请求， 但目前是处理中状态
- 207 Multi-Status：存在多种状态
- 422 Unprocessible Entity：格式正确， 内容有误
- 423 Locked：资源已被加锁
- 424 Failed Dependency：处理与某请求关联的请求失败， 因此不再维持依赖关系
- 507 Insufficient Storage：保存空间不足

由于 WebDAV 是基于 HTTP 的，所以具有 HTTP 的所有优点，包括容易穿越防火墙、使用 HTTPS 来传输数据，因此在很多方面可以替代 FTP。

WebDAV 可以通过 Nginx 或 Apache 等 Web 服务器部署。在客户端 WebDAV 也获得了许多软件的支持，比如 Office 就可通过 WebDAV 编辑远程文档。