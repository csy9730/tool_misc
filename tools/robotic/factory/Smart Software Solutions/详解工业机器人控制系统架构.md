# 详解工业机器人控制系统架构

[![橙色云设计](https://pic1.zhimg.com/v2-ffbf78aa4d2da11c945fe3725096bc2e_xs.jpg?source=172ae18b)](https://www.zhihu.com/org/cheng-se-yun-she-ji)

[橙色云设计](https://www.zhihu.com/org/cheng-se-yun-she-ji)

汇聚全球智力 协同研发设计



57 人赞同了该文章

本文比较了机械臂和移动机器人两种工业机器人的控制系统方案，对其特点进行了介绍。

![img](https://pic3.zhimg.com/80/v2-0039044a53e2ab507bd928a025b96c3a_1440w.jpg)

以上分类是根据应用对象，此外，市面上更多的是通用型运动控制器，即控制非标设备的。

![img](https://pic4.zhimg.com/80/v2-f623af20ee8bd894e215899051c1f46f_1440w.jpg)

## **1　控制器底层方案**

### **1.1　机械臂类**

机械臂类的控制器发展较早，相对成熟，先来看看现有的控制系统底层方案。

![img](https://pic3.zhimg.com/80/v2-d6dbbe610cb5bf91f8cce893fb8943a6_1440w.jpg)

### **1.2　移动机器人类**

移动机器人的控制器属于较新的方向，工业移动机器人有AGV、无人驾驶工程机械等形式，控制系统底层方案如下：

![img](https://pic1.zhimg.com/80/v2-7648db2ec85ba213a8ebebb2c7378360_1440w.jpg)

### **1.3　对比**

机械臂对精度和运动稳定性的要求较高，因此计算量大、周期短，比移动机器人一般要高1到2个量级。移动机器人一般对同步精度要求不高，其配置相对较低。

机械臂一般工作于固定的区域，其控制器通常放置于机箱内，因此防护等级不高，一般是IP20。

移动机器人由于需要经常运动，尤其是室外工程机械，要考虑防水防尘，其防护等级较高，一般是IP67。

![img](https://pic1.zhimg.com/80/v2-6b98449abc253a444360e606b91c08b8_1440w.jpg)

## **2　CoDeSys介绍**

### **2.1　CoDeSys的组成**

你会发现，很多的机器人控制软件都是借助CoDeSys实现的，那么什么是CoDeSys呢？

CoDeSys是一款付费的软PLC开发软件，简单来说，它包括两部分：Development System和Runtime System。Development System就是用来编程的软件界面（就像Visual Studio、Eclipse等软件，也可以称为IDE），**设计、调试、编译PLC程序都在IDE中进行，这部分是用户经常打交道的；**

PLC程序写好了以后，就要把它转移到硬件设备中运行。可是这时生成的PLC程序自己是无法运行的，它还要在一定的软件环境中才能工作，这个环境就是Runtime System，这部分是用户看不到的。

二者安装的位置通常不同，IDE一般安装在开发电脑上，Runtime System则位于起控制作用的硬件设备上，二者一般使用网线连接，程序通过网线下载到Runtime中运行。

![img](https://pic4.zhimg.com/80/v2-85f2f79d57d7d40389e0d6dc8af36ecf_1440w.jpg)

CoDeSys在国内知名度不高，但是在欧洲久负盛名，尤其在工业控制领域。我们上面提到的很多机器人公司都使用了它的产品，例如KEBA、倍福、固高，还有几乎所有的移动机器人控制器厂家。

设计CoDeSys的3S公司只卖软件，不卖硬件。硬件电路需要由用户自己设计，3S公司负责将Runtime System移植到客户的硬件上。Runtime System可以裸跑在硬件上，但一般是运行在操作系统上，配置操作系统也是客户的工作。

如果客户要求，CoDeSys的IDE可以定制，换成客户的logo和外观，这就是为什么你会发现不同厂家的开发平台长得不一样，但风格又比较相似。

当然，用户也可以使用其它IDE，例如倍福就使用了微软的Visual Studio，而背后的编译器等内核以及函数库仍然采用CoDeSys的方案。

CoDeSys的Runtime具有强大的适应性，支持绝大多数的操作系统和硬件芯片架构。



![img](https://pic1.zhimg.com/80/v2-caebacf6da3ec5d954d4ffe3a235c0ec_1440w.jpg)

### **2.2　CoDeSys Runtime原理**

CoDeSys的IDE部分是免费的，你可以从其官网下载体验体验。真正收费的是运行系统Runtime System。

![img](https://pic1.zhimg.com/80/v2-7ea39fff21d6125415ac850656119b10_1440w.jpg)

CoDeSys在设计之初就将功能划分为若干组件模块，例如总线协议栈、可视化界面、运动控制、安全控制等等，用户可以像搭积木一样选购必需的模块搭建自己的系统，最后形成一个定制化的控制软件平台。

一些初次接触软PLC的用户可能对这部分感到陌生，但其实这种设计方式非常普遍。举几个例子，MATLAB Simulink的实时工具箱（Real-Time）就是这样的工作方式，用户在Simulink的图形界面里通过拖拽设计控制程序，然后下载到真实的硬件中跑，可以在这里了解。

还有像倍福也是这样的使用方式，用户在TwinCAT IDE里进行编程，然后下载到倍福的控制器中，控制器里面其实已经预装了一个Runtime。西门子的STEP7也是一款IDE，它的PLC中也存在一个配套的Runtime。

用户编写的PLC程序就像我们电脑里的应用程序，它运行在Runtime System上，而Runtime System又运行在操作系统之上。

Runtime System位于应用程序和操作系统之间。所以可以被称为中间件（Middleware）。在机器人软件里面，处于同样地位的还有ROS、OROCOS（Real-Time Toolkit）等等。

机器人的控制，像数控机床一样，对实时性有要求，因此我们选择的操作系统最好是实时操作系统（RTOS）。遗憾的是，我们经常用的操作系统都不是实时的，例如Windows和Linux。但幸运的是，有人对它们进行了改造，也就是加入实时补丁。

常用的实时操作系统有：VxWorks、QNX、Windows RTX、Xenomai、RT Linux、Linux RTAI、WinCE、μC/OS、SylixOs等等。考虑到Windows和Linux这两款操作系统的用户较多，CoDeSys推出了相应的实时补丁（RTE），为用户免去了改造的烦恼。

想了解更多的CoDeSys Runtime信息可以阅读官方的文档[Math Processing Error] [1][2][1][2]。

### **2.3　CoDeSys的缺点**

CoDeSys给我们开发控制器带来了便利，省去了从零开始的麻烦，但是依靠CoDeSys这类商业软件开发自己的控制器产品也存在不少的缺点：

**1） 底层算法不公开**

CoDeSys集成的运动控制组件、总线协议栈都是封装好的，用户无法了解其内部细节，也无法针对自己的具体需求进行定制优化，只能简单地调用。用户只能依附于CoDeSys平台，难以形成自己的核心技术。

**2）功能有限，难以扩展**

现在以机器视觉、人工智能、自动驾驶等为代表的新技术突飞猛进，而工业控制上的很多技术仍然停留在20年前。以移动机器人中的导航场景为例，基于视觉或者激光的导航方法需要采集大量的数据并对其进行处理，其中涉及相当多的矩阵计算。

而现在PLC只能进行落后的一维数字计算，难以实现复杂的算法。与人工智能圈子喜欢开源的风格正好相反，工业控制圈子相互封闭，谁都不肯开放自家的函数库，开源函数库极少（OSCAT），就连最基本的滤波算法、矩阵计算都要自己从头开始写。而且，国际标准提供的基本函数太过有限，完全无法适应新的场景，急需扩展。

**3） 难以更新**

由于完全依赖CoDeSys，客户自己产品硬件的升级换代需要重新定制移植，导致成本增加。

## **3　开源方案**

目前存在一些开源的控制系统方案，例如Beremiz、Orocos、OpenPLC、OpenRTM、ORCA。

开发机器人控制器是个繁重的工作，要明确一系列性能要求，首先是实时性

实时性对于工业机器人来说一般是必须的，对于服务或娱乐机器人则未必。一般人很容易错把“实时性”理解为处理或者响应速度快，但是其实“实时性”表示时间上的“确定性”，例如实时操作系统（RTOS）中的中断响应或者进程切换的延迟时间一定是在一个时间范围内。

我们常用的操作系统（Windows、Linux）都不是实时操作系统，因为它们设计的初衷是吞吐量，不能保证每个事件都在一定范围内得到处理。再比如，标准以太网的传输速度比实时工业以太网快多了，但是它也却不是实时的，因为它同样不能保证数据在给定的时间内完成传输。

理解实时性不太难，可是机器人哪些的任务需要实时运行呢？如何根据机器人的性能要求确定程序运行的时间间隔呢（是1ms还是10ms）？实时性取决于硬件还是软件呢？

如何根据实时性选择具体的软硬件呢（该选择ARM还是X86、Linux RTAI还是VxWorks）？网上缺少这方面的深入讨论，各大机器人厂家也不会公开自己的测试和试验结果，似乎这方面主要依靠经验和试错。

这里我也只能提供几个指标，目前工业机械臂的控制周期是1ms左右，性能较高的伺服驱动器位置环的控制周期可以达到125[Math Processing Error] mu sμs。

PLCopen定义了伺服和运动控制的一些标准，包括编程语言、运动控制基础函数块（Function Block）、输入输出接口的参数等[Math Processing Error] ^{[3]}

[3]具体的实现代码细节，这个是由各个厂家提供的。

作者：robinvista

来源：CSDN

版权声明：本文为博主原创文章，转载请附上博文链接！

编辑于 2019-11-04

工业机器人

工业设计

机械手臂

赞同 57