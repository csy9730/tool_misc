# 使用树莓派控制局域网内的电脑开关机

![img](https://upload.jianshu.io/users/upload_avatars/7574151/67ca9990-c4f7-4715-9715-e932f14cedc9.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/96/h/96)

[luv39](https://www.jianshu.com/u/5e5ccfc4217a)

0.6482019.07.09 17:06:57字数 165阅读 3,278

# 使用树莓派控制局域网内的电脑开关机

[TOC]

## 开机

### 配置电脑端

- 设置BIOS允许从网卡启动
- 打开网络和共享中心--以太网--属性--配置--电源管理--允许此设备唤醒计算机

### 配置树莓派



```bash
# 安装wakeonlan
sudo apt install wakeonlan

# 查询电脑的IP地址和网卡的mac地址
arp -a

? (192.168.8.180) at cc:08:fb:f7:44:a3 [ether] on eth0
tom-ubuntu.lan (192.168.8.112) at 00:e0:4c:68:06:28 [ether] on eth0
tom-desktop.lan (192.168.8.199) at 04:92:26:cf:87:f7 [ether] on eth0
C-329.lan (192.168.8.1) at a8:80:38:22:ee:0f [ether] on eth0

# 使用wakeonlan唤醒计算机
wakeonlan -i 192.168.8.199 04:92:26:cf:87:f7

Sending magic packet to 192.168.8.199:9 with 04:92:26:cf:87:f7
```

## 关机

### 配置电脑端

- 打开**服务**--找到**Remote Registry**服务并设置为**自动**启动--登录选项卡勾选**本地系统账户** 
- 打开防火墙--允许应用通过防火墙--勾选**远程服务管理** 
- 修改注册表 
  - 导航到**HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/Windows/CurrentVersion/Policies/System** 
  - 创建名为**LocalAccountTokenFilterPolicy**的DWORD
  - 设置**LocalAccountTokenFilterPolicy**的值为**1** 

### 配置树莓派端



```bash
# 安装samba
sudo apt install samba

# 使用命令关机
net rpc shutdown -I 192.168.8.199 -U username%password
```