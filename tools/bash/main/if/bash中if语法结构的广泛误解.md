# 关于bash中if语法结构的广泛误解

[bash中if语法结构的广泛误解](http://www.linuxdiyf.com/viewarticle.php?id=105505)

何人, 或者说几乎任何人, 都会在这种描述下自然地认为: [ 和 ] 是这种语法结构本身的一部分, 并且, 老老实实地在自己的脚本中总是这样使用if 语句, 如果你总是在判断字符串是否相等, 或文件的各种属性, 这么做倒是没错, 只不过你可能会这样犯错:(下文都假设$1内容为-a)

`if ["$1" = "-a" ]` 或 `if [ "$1 = "-a"]`

毕竟, 很多其它语言中, 特殊符号如()、{}做分隔符时, 可以与被分隔内容亲密无间. 而bash会来答复你的这种写法:
```
[-a: command not found
bash: [: missing `]'
```
我相信， 以上这种心理模型造成的失败后果十分严重, bash的错误信息显示出它内部并不这样看待if 条件语句的结构.

上面的模型同样不能解释下面的合法bash 命令:

`[ "$1" = "-a" ]`

仅仅这本身就是一个合法的命令, 没有if、then、fi这些东西，当然, 下面这样的也合法

`[ "$1" = "-a" ] && echo yes`

你如何解释这些烂事? 当然你可以自圆其说地不断对上面的if进行补充, 呃, [ .. ] 这种结构就是这么特别, 你必需在[之后有至少一个空格, 并且在]之前也至少有一个空格, 同时[..] 结构还可以单独出现, 就象上面这样, 另外... 这样的解释简直是自欺欺人, 我敢保证企图对自己这样解释的人根本自己就在怀疑这种说法, 因为你根本不知道这个结构还有其它什么怪诞诡秘之处何时会突然跳出来让你大吃一惊. 我承认，我自己也曾经经历过这样的想法.

为了彻底批判这种错误概念, 容我再举一例:
``` bash
if ps ax | grep oracle > /dev/null 2>&1 ; then
...
fi
```
首先, 这是合法的, 它的目的是想知道进程列表中有没有与oracle相关的东西, 当然, 如果你够牛, 就能看出这种做法有另外的问题. 但这不是我想说的重点.

我想说的是, 你前面被教导的这种if 语句的语法模型, 如何解释这个, [ 与 ] 又不见了, 并且还出现了管道, 普通的管道我们都见过, 但它能安全地出现在if 语句中吗, 并且, 让你感觉熟悉和安全的[ 和 ]又不见了.

好吧, 拨乱的部分至此为止, 如果你想获得一个关于bash中if结构的正确的健康的环保的知识, 就打起精神往下看:

1. 首先, [ 在bash中没有特殊地位, 它是一个命令, 就跟cat, ls, grep一样让你感到熟悉的命令. 它不是关键字，虽然它的更出色的胞弟"[["是

`echo [`

你就得到 [, 不信就试试, bash不会报告任何错误! 但这不说明它不是关键字， `echo if`你也能得到if

所以, 请再试: `which [`, 显示 `[: shell built-in command`

以及 `ls -l $(which [)`

2. 然后, if 的真正模型是:

`if COMMANDS; then COMMANDS; [ elif COMMANDS; then COMMANDS; ]... [ else COMMANDS; ] fi`

其实, bash中的help if就给了你正确的答案, 但我不知道什么原因无数人就是忽略了它, 而非常多的bash教学资料中都采用了本文开头提出的那种模型来告诉你关于if 结构的事.

注意: `[ "$1" = "-a" ]` 只一个命令, [ 是命令名!, "$1"是第一个参数, =是第二个参数, "-a"是第三个, ]是第4个. 是[这个命令, 而不是bash本身在报怨 [ "$1" = "-a"] 这样的结构造成的错误, 因为[这个命令对它的参数有所期望, 它期望最后一个参数是 ], 而你用"-a"] 这种连写的形式, 它得到的就只有3个参数: $1, = 和 -a].

这也解释了这样的错误:
`["$1" = "-a" ]`

bash解释器得到了这样的一个命令行:
`[-a = "-a" ]`

当然, 它认为 `[-a` 是命令名部分, 而你的系统中没有这个命令, 所以会报告说:
`[-a: command not found`

3. 其次, bash中有一个builtin的 [命令, 通常你使用[执行的都是这个内置的命令, 目的是效率. 启动一个进程的代价太高.

试试 `type [` 
显示：`if is a reserved word`


[top](https://www.cnblogs.com/haivey/archive/2012/09/04/2669870.html#a0)


## misc

`if` 是 保留字
`[` 是 sh的内置命令
`ls` 是 程序