# 方波和三角波的THD理论值计算

[![仲夏夜的乙醇](https://picx.zhimg.com/v2-29772df8c2e3adc42e262f5a2094dc1d_xs.jpg?source=172ae18b)](https://www.zhihu.com/people/EtOHofNight)

[仲夏夜的乙醇](https://www.zhihu.com/people/EtOHofNight)

双非CS专业菜鸡一枚



13 人赞同了该文章

## 前言

发现自己有三个月没在知乎写文章了，想随便水一篇。正好考研数学复习到三角级数了，就写一篇和它有关的应用吧。

灵感出自2020年福建省大学生电子设计竞赛赛题。

## THD的定义

THD指的是总谐波失真。所谓谐波失真，是指输出信号比输入信号多出的谐波成分。这些多余出来的谐波成分与实际输入信号的对比，用百分比来表示就称为总谐波失真。

对于THD的计算，不同的标准会有所不同。

1、根据标准《GB/T 17626.7-2008电磁兼容 试验和测量技术 供电系统及所连设备谐波、谐间波的测量和测量仪器导则》，THD的定义为：

不大于某特定阶数H的所有谐波分量有效值 Gn 与基波分量有效值 G1 比值的方和根：

THD=∑n=2H(GnG1)2

2、标准《GB/T 12668.2-2002 调速电气传动系统 一般要求 低压交流变频电气传动系统额定值的规定》给出的THD计算公式如下：

THD=Q2−Q12Q12

式中Q1为基波有效值，Q为总有效值，可由电压或电流值表示。

本文选取第一个标准的公式进行计算，有效值使用电压表示，阶数H取值为5。

## 利用傅里叶变换进行计算

我们知道，一个信号可以表示成它的基波和谐波的叠加。利用傅里叶变换可以分析信号的频域特性，从而提取出信号的基波分量和谐波分量的有效值。

假设信号的电压值以f(x)表示，且f(x)的周期为2l，那么可以将f(x)表示成：

f(x)=a02+∑n=1∞(ancosnπxl+bnsinnπxl)

其中 an=1l∫−llf(x)cosnπxldx ， bn=1l∫−llf(x)sinnπxldx

对于f(x)的傅里叶级数形式而言， ancosnπxl+bnsinnπxl 这部分又可以利用两角和的余弦公式写成： Uncos(nπxl+φ) 。式子的 φ 值并不重要，我们只是用它的系数 Un 去代入THD的计算公式。这个系数正是基波分量or谐波分量的有效值。

## 方波THD的计算过程

这里选择的对称方波进行计算。对称方波的函数表达式为：

f(x)={−1−1≤x<010≤x<1

为了简化计算，不妨设f(x)的峰值为1，周期为2。f(x)为奇函数，因此不必计算 an ，只需计算 bn 的数值即可。 Un 的数值即为 bn 。

具体的计算过程如下：

bn=∫−11f(x)sin(nπx)dx

=∫−10f(x)sin(nπx)dx+∫01f(x)sin(nπx)dx

=−1nπ∫−10sin(nπx)d(nπx)+1nπ∫01sin(nπx)d(nπx)

=1nπcos(nπx)|−10−1nπcos(nπx)|01

=1nπ[1−cos(nπ)]+1nπ[1−cos(nπ)]

=2nπ[1−cos(nπ)]

n依次取1,2,3,4,5再代入得：

b1=4π ， b2=0 ， b3=43π ， b4=0 ，b5=45π

代入THD公式计算得，对称方波THD的理论值为0.3887。

## 三角波THD的计算过程

本文选用的三角波函数f(x)为：

f(x)={−1−x−1≤x<−12x−12≤x<121−x12≤x<1

为了简化计算，不妨设f(x)的峰值为1，周期为2。f(x)为奇函数，因此不必计算 an ，只需计算 bn 的数值即可。 Un 的数值即为 bn 。

具体的计算过程如下：

bn=∫−11f(x)sin(nπx)dx

=∫−1−12f(x)sin(nπx)dx+∫−1212f(x)sin(nπx)dx+∫121f(x)sin(nπx)dx

=∫−1−12(−1−x)sin(nπx)dx+∫−1212xsin(nπx)dx+∫121(1−x)sin(nπx)dx

=−∫−1−12sin(nπx)dx−∫−1−12xsin(nπx)dx+∫−1212xsin(nπx)dx

+∫121sin(nπx)dx−∫121xsin(nπx)dx

对于 ∫xsin(nπx)dx ，计算过程如下：

∫xsin(nπx)dx=−1nπ∫xd(cos(nπx))

=−1nπxcos(nπx)+1nπ∫cos(nπx)dx

=−1nπxcos(nπx)+1n2π2sin(nπx)+C

之后再进行定积分的计算和化简。最终计算得：bn=4n2π2sinnπ2

n依次取1,2,3,4,5再代入得：

b1=4π2 ， b2=0 ， b3=−49π2 ， b4=0 ， b5=425π2

代入THD公式计算得，对称方波THD的理论值为0.1180。

## 后记

其实THD这个东西我也是被同学叫去设计算法才开始考虑怎么算的。本来用傅里叶变换去算是非常容易的事情，但是单片机的内存和运行速度连这种算法都跑不起来。具体实现的时候，我采用了硬件带通滤波器加上检波电路（带通滤波后**信号在时域上仍然具有负值**，而负值无法被基于数字电路的单片机进行处理）来提取相应的基波分量和谐波分量，再进行THD的计算。在实现的过程中，我和电气工程的同学交流了很多，也收获了很多。

## 参考文献

> 1、《GB/T 17626.7-2008电磁兼容 试验和测量技术 供电系统及所连设备谐波、谐间波的测量和测量仪器导则》
> 2、《GB/T 12668.2-2002 调速电气传动系统 一般要求 低压交流变频电气传动系统额定值的规定》

发布于 2020-10-20 00:24

谐波失真

傅里叶变换（Fourier Transform）