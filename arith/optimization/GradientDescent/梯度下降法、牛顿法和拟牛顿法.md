# 梯度下降法、牛顿法和拟牛顿法

[Eureka](https://www.zhihu.com/people/eureka-42-21)





886 人赞同了该文章

## [专栏文章汇总](https://zhuanlan.zhihu.com/p/37523664)



本文结构如下

1：梯度下降法

- 1.1 梯度
- 1.2 梯度下降的直观解释
- 1.3 梯度下降算法法
- 1.4 梯度下降的算法调优
- 1.5 梯度下降法大家族（BGD，SGD，MBGD）
- 1.5.1 批量梯度下降法（Batch Gradient Descent）
- 1.5.2 随机梯度下降法（Stochastic Gradient Descent）
- 1.5.3 小批量梯度下降法（Mini-batch Gradient Descent）
- 1.6 批量梯度下降法python实现
- 1.7 梯度下降法和最小二乘法

2： 牛顿法

- 2.1 求解方程
- 2.2 最优化
- 2.3 牛顿法与梯度下降法

3： 拟牛顿法的思路

4： DFP(Davidon-Fletcher-Powell)算法(DFP algorithm)

5： BFGS(Broyden-Fletcher-Goldfard-Shano)算法(BFGS algorithm)

6： Broyden类算法(Broyden's algorithm)

7： 参考文献

------

## **1： 梯度下降法**

**1.1 梯度**

导数我们都非常熟悉，既可以表示某点的切线斜率，也可以表示某点变化率，公式如下表示：
![[公式]](https://www.zhihu.com/equation?tex=f%27%28x%29%3D%5Cunderset%7B%5CDelta+x%5Crightarrow+0%7D%7Blim%7D%5Cfrac%7B%5CDelta+y%7D%7B%5CDelta+x%7D%3D%5Cunderset%7B%5CDelta+x%5Crightarrow+0%7D%7Blim%7D%5Cfrac%7Bf%28x%2B%5CDelta+x%29-f%28x%29%7D%7B%5CDelta+x%7D%5C%5C)

当函数是多元时，倒数就变成了偏导数： ![[公式]](https://www.zhihu.com/equation?tex=f_x%28x%2Cy%29) 表示当 ![[公式]](https://www.zhihu.com/equation?tex=y) 不变时， ![[公式]](https://www.zhihu.com/equation?tex=f%28x%2Cy%29) 沿着 ![[公式]](https://www.zhihu.com/equation?tex=x) 轴的变化变化率； ![[公式]](https://www.zhihu.com/equation?tex=f_y%28x%2Cy%29) 表示当 ![[公式]](https://www.zhihu.com/equation?tex=x) 不变时， ![[公式]](https://www.zhihu.com/equation?tex=f%28x%2Cy%29) 沿着 ![[公式]](https://www.zhihu.com/equation?tex=y) 轴的变化变化率。

但是多元函数是一个平面，方向有很多， ![[公式]](https://www.zhihu.com/equation?tex=x) 轴 ![[公式]](https://www.zhihu.com/equation?tex=y) 轴只是其中两个方向而已，假如我们需要其他方向的变化率怎么办呢？因此方向导数就有用了，顾名思义，方向导数可以表示任意方向的倒数。

假如二次函数 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%2Cy%29) ，方向 ![[公式]](https://www.zhihu.com/equation?tex=u%3Dcos%5Ctheta+~i%2Bsin%5Ctheta+~j) （为单位向量）的方向导数公式如下： ![[公式]](https://www.zhihu.com/equation?tex=%5Cunderset%7Bt%5Crightarrow+0%7D%7Blim%7D%5Cfrac%7Bf%28x%2Bt~cos%5Ctheta%2Cy%2Bt~sin%5Ctheta%29-f%28x%29%7D%7Bt%7D) ，记为 ![[公式]](https://www.zhihu.com/equation?tex=D_uf) 。其中 ![[公式]](https://www.zhihu.com/equation?tex=D_uf%3Df_x%28x%2Cy%29cos%5Ctheta%2Bf_y%28x%2Cy%29sin%5Ctheta%3D%5Cbegin%7Bbmatrix%7Df_x%28x%2Cy%29%26f_y%28x%2Cy%29%5Cend%7Bbmatrix%7D%5Cbegin%7Bbmatrix%7Dcos%5Ctheta%5C%5C+sin%5Ctheta%5Cend%7Bbmatrix%7D) 。我们记为： ![[公式]](https://www.zhihu.com/equation?tex=D_uf%3D%5Cmathbf%7BA%7D%5Ctimes+%5Cmathbf%7BI%7D%3D%5Cbegin%7Bvmatrix%7D%5Cmathbf%7BA%7D+%5Cend%7Bvmatrix%7D%5Cbegin%7Bvmatrix%7D%5Cmathbf%7BI%7D+%5Cend%7Bvmatrix%7Dcos%5Calpha) ，其中 ![[公式]](https://www.zhihu.com/equation?tex=%5Calpha) 是两向量的夹角。我们可以知道，当 ![[公式]](https://www.zhihu.com/equation?tex=%5Calpha) 为0时，方向导数 ![[公式]](https://www.zhihu.com/equation?tex=D_uf) 达到最大，此时的方向导数即为梯度。

更多的关于梯度的知识点可以看里面的回答：[如何直观形象的理解方向导数与梯度以及它们之间的关系？](https://www.zhihu.com/question/36301367/answer/156102040)

从几何意义上来说，梯度向量就是函数变化增加最快的地方。具体来说，对于函数 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%2Cy%29) ,在点 ![[公式]](https://www.zhihu.com/equation?tex=%28x_0%2Cy_0%29) ，沿着梯度向量的方向就是 ![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Bbmatrix%7D%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+x_0%7D%5C%5C+%5Cfrac%7B%5Cpartial+f%7D%7B%5Cpartial+y_0%7D%5Cend%7Bbmatrix%7D) 的方向是 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%2Cy%29) 增加最快的地方（还记得梯度怎么来的吗？方向导数的最大值，粗暴点，就是导数最大值）。或者说，沿着梯度向量的方向，更加容易找到函数的最大值。反过来说，沿着梯度向量相反的方向（去负号），则就是更加容易找到函数的最小值。



**1.2 梯度下降的直观解释**

比如我们在一座大山上的某处位置，由于我们不知道怎么下山，于是决定走一步算一步，也就是在每走到一个位置的时候，求解当前位置的梯度，沿着梯度的负方向，也就是当前最陡峭的位置向下走一步，然后继续求解当前位置梯度，向这一步所在位置沿着最陡峭最易下山的位置走一步。这样一步步的走下去，一直走到觉得我们已经到了山脚。当然这样走下去，有可能我们不能走到山脚，而是到了某一个局部的山峰低处（局部最小值）。

从上面的解释可以看出，梯度下降不一定能够找到全局的最优解，有可能是一个局部最优解。当然，如果损失函数是凸函数，梯度下降法得到的解就一定是全局最优解。

![img](https://pic3.zhimg.com/80/v2-dd6ce242d10f41e2f20e15dfce22cd52_1440w.jpg)



**1.3 梯度下降算法法**

梯度下降法(Gradient descent)或最速下降法(steepest descent)是求解无约束最优化问题的一种常用的、实现简单的方法。

假设 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 是 ![[公式]](https://www.zhihu.com/equation?tex=R%5E%7Bn%7D) 上具有一阶连续偏导数的函数。求解
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C+%26+%5Cmin_%7Bx+%5Cin+R%5E%7Bn%7D%7D+f+%5Cleft%28+x+%5Cright%29+%5Cend%7Balign%2A%7D+%5C%5C)
无约束最优化问题。 ![[公式]](https://www.zhihu.com/equation?tex=f%5E%7B%2A%7D) 表示目标函数 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 的极小点。

梯度下降法是一种迭代算法。选取适当的初值 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%280%29%7D) ，不断迭代，更新 ![[公式]](https://www.zhihu.com/equation?tex=x) 的值，进行目标函数的极小化，直到收敛。由于负梯度方向是使函数下降最快的的方向，在迭代的每一步，以负梯度方向更新 ![[公式]](https://www.zhihu.com/equation?tex=x) 的值，从而达到减少函数值的目的。

第 ![[公式]](https://www.zhihu.com/equation?tex=k%2B1) 次迭代值
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C+%26+x%5E%7B%5Cleft%28+k%2B1+%5Cright%29%7D+%5Cleftarrow+x%5E%7B%5Cleft%28+k+%5Cright%29%7D+%2B+%5Clambda_%7Bk%7D+p_%7Bk%7D+%5Cend%7Balign%2A%7D+%5C%5C)
其中， ![[公式]](https://www.zhihu.com/equation?tex=p_%7Bk%7D) 是搜索方向，取负梯度方向 ![[公式]](https://www.zhihu.com/equation?tex=p_%7Bk%7D%3D+-+%5Cnabla+f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D+%5Cright%29%EF%BC%8C%5Clambda_%7Bk%7D) 是步长，由一维搜索确定，即 ![[公式]](https://www.zhihu.com/equation?tex=%5Clambda_%7Bk%7D) 使得
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C+%26+f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda_%7Bk%7Dp_%7Bk%7D+%5Cright%29%3D%5Cmin_%7B%5Clambda+%5Cgeq+0%7D+f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda+p_%7Bk%7D+%5Cright%29+%5Cend%7Balign%2A%7D+%5C%5C)

> **梯度下降算法：**
> 输入：目标函数 ![[公式]](https://www.zhihu.com/equation?tex=f+%5Cleft%28+x+%5Cright%29) ，梯度函数 ![[公式]](https://www.zhihu.com/equation?tex=g%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D+%5Cright%29%3D%5Cnabla+f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) ，计算精度 ![[公式]](https://www.zhihu.com/equation?tex=%5Cvarepsilon)
> 输出： ![[公式]](https://www.zhihu.com/equation?tex=f+%5Cleft%28+x+%5Cright%29+) 的极小点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D)
> \1. 取初值 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%280%5Cright%29%7D+%5Cin+R%5E%7Bn%7D) ，置 ![[公式]](https://www.zhihu.com/equation?tex=k%3D0)
> \2. 计算 ![[公式]](https://www.zhihu.com/equation?tex=f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29)
> \3. 计算梯度 ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%7D%3Dg%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D+%5Cright%29) ，当 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7C+g_%7Bk%7D+%5C%7C+%3C+%5Cvarepsilon+) 时，停止迭代，令 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D) ；否则，令 ![[公式]](https://www.zhihu.com/equation?tex=p_%7Bk%7D%3D-g%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) ，求 ![[公式]](https://www.zhihu.com/equation?tex=%5Clambda_%7Bk%7D) ，使
> ![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C+%26+f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda_%7Bk%7Dp_%7Bk%7D+%5Cright%29%3D%5Cmin_%7B%5Clambda+%5Cgeq+0%7D+f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda+p_%7Bk%7D+%5Cright%29+%5Cend%7Balign%2A%7D+%5C%5C)
> \4. 置 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%3D+x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda_%7Bk%7Dp_%7Bk%7D) ，计算 ![[公式]](https://www.zhihu.com/equation?tex=f+%5Cleft%28+x%5E%7B%5Cleft%28k%EF%BC%8B1%5Cright%29%7D+%5Cright%29)
> 当 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7C+f+%5Cleft%28+x%5E%7B%5Cleft%28k%EF%BC%8B1%5Cright%29%7D+%5Cright%29+-+f+%5Cleft%28+x%5E%7B%5Cleft%28k%5Cright%29%7D+%5Cright%29+%5C%7C+%3C+%5Cvarepsilon+) 或 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7C+x%5E%7B%5Cleft%28k%EF%BC%8B1%5Cright%29%7D+-+x%5E%7B%5Cleft%28k%5Cright%29%7D+%5C%7C+%3C+%5Cvarepsilon+) 时，停止迭代，令 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D%3Dx%5E%7Bk%2B1%7D)
> \5. 否则，置 ![[公式]](https://www.zhihu.com/equation?tex=k%3Dk%2B1) ，转3.



**1.4 梯度下降的算法调优**

在使用梯度下降时，需要进行调优。哪些地方需要调优呢？

1. **算法的步长选择**。步长取值取决于数据样本，可以多取一些值，从大到小，分别运行算法，看看迭代效果，如果损失函数在变小，说明取值有效，否则要增大步长。步长太大，会导致迭代过快，甚至有可能错过最优解。步长太小，迭代速度太慢，很长时间算法都不能结束。所以算法的步长需要多次运行后才能得到一个较为优的值。
2. **算法参数的初始值选择**。初始值不同，获得的最小值也有可能不同，因此梯度下降求得的只是局部最小值；当然如果损失函数是凸函数则一定是最优解。由于有局部最优解的风险，需要多次用不同初始值运行算法，关键损失函数的最小值，选择损失函数最小化的初值。
3. **归一化**。由于样本不同特征的取值范围不一样，可能导致迭代很慢，为了减少特征取值的影响，可以对特征数据归一化。



**1.5 梯度下降法大家族（BGD，SGD，MBGD）**

> **1.5.1 批量梯度下降法（Batch Gradient Descent）**
> 批量梯度下降法，是梯度下降法最常用的形式，具体做法也就是在更新参数时使用所有的样本来进行更新。
>
> **1.5.2 随机梯度下降法（Stochastic Gradient Descent）**
> 随机梯度下降法，其实和批量梯度下降法原理类似，区别在与求梯度时没有用所有的样本的数据，而是仅仅选取一个样本来求梯度。
> 随机梯度下降法，和批量梯度下降法是两个极端，一个采用所有数据来梯度下降，一个用一个样本来梯度下降。自然各自的优缺点都非常突出。对于训练速度来说，随机梯度下降法由于每次仅仅采用一个样本来迭代，训练速度很快，而批量梯度下降法在样本量很大的时候，训练速度不能让人满意。对于准确度来说，随机梯度下降法用于仅仅用一个样本决定梯度方向，导致解很有可能不是最优。对于收敛速度来说，由于随机梯度下降法一次迭代一个样本，导致迭代方向变化很大，不能很快的收敛到局部最优解。
>
> **1.5.3 小批量梯度下降法（Mini-batch Gradient Descent）**
> 小批量梯度下降法是批量梯度下降法和随机梯度下降法的折衷，也就是对于 ![[公式]](https://www.zhihu.com/equation?tex=m) 个样本，我们采用 ![[公式]](https://www.zhihu.com/equation?tex=x) 个样子来迭代， ![[公式]](https://www.zhihu.com/equation?tex=1%3Cx%3Cm) 。一般可以取 ![[公式]](https://www.zhihu.com/equation?tex=x%3D16%2C32%2C64...) ，当然根据样本的数据，可以调整这个 ![[公式]](https://www.zhihu.com/equation?tex=x) 的值。

上述三种方法得到局部最优解的过程如下：

![img](https://pic2.zhimg.com/80/v2-90f692dad69159016672bf329edd1cb1_1440w.jpg)



**1.6 批量梯度下降法python实现**

```python
def train(X, y, W, B, alpha, max_iters):
    '''
    使用了所有的样本进行梯度下降
    X: 训练集,
    y: 标签,
    W: 权重向量,
    B: bias,
    alpha: 学习率,
    max_iters: 最大迭代次数.
    '''
    dW = 0 # 权重梯度收集器
    dB = 0 # Bias梯度的收集器
    m = X.shape[0] # 样本数
    for i in range(max_iters):
        dW = 0 # 每次迭代重置
        dB = 0
        for j in range(m):
            # 1. 迭代所有的样本
            # 2. 计算权重和bias的梯度保存在w_grad和b_grad,
            # 3. 通过增加w_grad和b_grad来更新dW和dB
            W = W - alpha * (dW / m) # 更新权重
            B = B - alpha * (dB / m) # 更新bias

    return W, B 
```



**1.7 梯度下降法和最小二乘法**

梯度下降法和最小二乘法相比，梯度下降法需要选择步长，而最小二乘法不需要。梯度下降法是迭代求解，最小二乘法是计算解析解。如果样本量不算很大，且存在解析解，最小二乘法比起梯度下降法要有优势，计算速度很快。但是如果样本量很大，用最小二乘法由于需要求一个超级大的逆矩阵，这时就很难或者很慢才能求解解析解了，使用迭代的梯度下降法比较有优势。

------

## **2： 牛顿法**

一般来说，牛顿法主要应用在两个方面，1：求方程的根；2：最优化。



**2.1 求解方程**

并不是所有的方程都有求根公式，或者求根公式很复杂，导致求解困难。利用牛顿法，可以迭代求解。

原理是利用泰勒公式，在 ![[公式]](https://www.zhihu.com/equation?tex=x_0) 处展开，且展开到一阶, 即 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3Df%28x_0%29%2Bf%27%28x_0%29%28x-x_0%29) 。求解方程 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3D0) ，等价于 ![[公式]](https://www.zhihu.com/equation?tex=f%28x_0%29%2Bf%27%28x_0%29%28x-x_0%29%3D0) ，求解 ![[公式]](https://www.zhihu.com/equation?tex=x%3Dx_1%3Dx_0-f%28x_0%29%2Ff%27%28x_0%29) 。因为这是利用泰勒公式的一阶展开， ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3Df%28x_0%29%2Bf%27%28x_0%29%28x-x_0%29) 处并不是完全相等，而是近似相等，这里求得的 ![[公式]](https://www.zhihu.com/equation?tex=x_1) 并不能让 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3D0) ，只能说 ![[公式]](https://www.zhihu.com/equation?tex=f%28x_1%29) 的值比 ![[公式]](https://www.zhihu.com/equation?tex=f%28x_0%29) 的值更接近于0，于是迭代的想法就很自然了，可以进而推出 ![[公式]](https://www.zhihu.com/equation?tex=x_%7Bn%2B1%7D%3Dx_%7Bn%7D-f%28x_n%29%2Ff%27%28x_%7Bn%7D%29) ，通过迭代，这个式子必然在 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%5E%2A%29%3D0) 的时候收敛。整个过程如下：

![img](https://pic2.zhimg.com/80/v2-45d3e471fdbc1b92ac31fc20cde882ad_1440w.jpg)



**2.2 最优化**

无约束最优化问题
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+%5Cmin_%7Bx+%5Cin+R%5E%7Bn%7D%7D+f%5Cleft%28x%5Cright%29%5Cend%7Balign%2A%7D+%5C%5C)

其中 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D) 为目标函数的极小点。

设 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 具有二阶连续偏导数，若第 ![[公式]](https://www.zhihu.com/equation?tex=k) 次迭代值为 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%5Cright%29%7D) ，则可将 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 在 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%5Cright%29%7D) 附近进行二阶泰勒展开
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+f%5Cleft%28x%5Cright%29+%3D+f%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%2Bg_%7Bk%7D%5E%7BT%7D%5Cleft%28x-x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%2B%5Cdfrac%7B1%7D%7B2%7D%5Cleft%28x-x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%5E%7BT%7D+H%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%5Cleft%28x-x%5E%7B%5Cleft%28x%5Cright%29%7D%5Cright%29%5Cend%7Balign%2A%7D+%5C%5C)

其中， ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%7D%3Dg%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%3D%5Cnabla+f%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) 是 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 的梯度向量在点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%5Cright%29%7D) 的值， ![[公式]](https://www.zhihu.com/equation?tex=H%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) 是 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 的海赛矩阵
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+H%5Cleft%28x%5Cright%29%3D%5Cleft%5B%5Cdfrac%7B%5Cpartial%5E%7B2%7Df%7D%7B%5Cpartial+x_%7Bi%7D+%5Cpartial+x_%7Bj%7D%7D%5Cright%5D_%7Bn+%5Ctimes+n%7D%5Cend%7Balign%2A%7D+%5C%5C)

在点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%5Cright%29%7D) 的值。

函数 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 有极值的必要条件是在极值点处一阶导数为0，即梯度向量为0。特别的当 ![[公式]](https://www.zhihu.com/equation?tex=H%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) 是正定矩阵时，函数 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 的极值为极小值。

我们为了得到一阶导数为0的点，可以用到2.1里的求解方程方法。根据二阶泰勒展开，对 ![[公式]](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%29) 在 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%5Cright%29%7D) 进行展开得（也可以对上述泰勒公式再进行求导）
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+%5Cnabla+f%5Cleft%28x%5Cright%29%3Dg_%7Bk%7D%2BH_%7Bk%7D%5Cleft%28x-x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%5Cend%7Balign%2A%7D+%5C%5C)
其中， ![[公式]](https://www.zhihu.com/equation?tex=H_%7Bk%7D%3DH%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) ，则
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+g_%7Bk%7D%2BH_%7Bk%7D%5Cleft%28x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D-x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%3D0+%5C%5C+%26+x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D-H_%7Bk%7D%5E%7B-1%7Dg_%7Bk%7D%5Cend%7Balign%2A%7D+%5C%5C)

我们令
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+H_%7Bk%7Dp_%7Bk%7D%3D-g_%7Bk%7D%5Cend%7Balign%2A%7D+%5C%5C)
则得到迭代公式
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D%2Bp_%7Bk%7D%5Cend%7Balign%2A%7D+%5C%5C)

最终可在 ![[公式]](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%5E%2A%29%3D0) 收敛。

> **牛顿法**：
> 输入：目标函数 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) ，梯度 ![[公式]](https://www.zhihu.com/equation?tex=g%5Cleft%28x%5Cright%29%3D%5Cnabla+f%5Cleft%28x%5Cright%29) ，海赛矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H%5Cleft%28x%5Cright%29) ，精度要求 ![[公式]](https://www.zhihu.com/equation?tex=%5Cvarepsilon)
> 输出： ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 的极小点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D)
> \1. 取初始点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%280%5Cright%29%7D) ，置 ![[公式]](https://www.zhihu.com/equation?tex=k%3D0)
> \2. 计算 ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%7D%3Dg%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29)
> \3. 若 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7Cg_%7Bk%7D%5C%7C+%3C+%5Cvarepsilon) 则停止计算，得近似解 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D)
> \4. 计算 ![[公式]](https://www.zhihu.com/equation?tex=H_%7Bk%7D%3DH%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) ，并求 ![[公式]](https://www.zhihu.com/equation?tex=p_%7Bk%7D)
> ![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+H_%7Bk%7Dp_%7Bk%7D%3D-g_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)
> \5. 置 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D%2Bp_%7Bk%7D)
> \6. 置 ![[公式]](https://www.zhihu.com/equation?tex=k%3Dk%2B1) ，转2.



**2.3： 牛顿法与梯度下降法**

梯度下降法和牛顿法相比，两者都是迭代求解，不过梯度下降法是梯度求解，而牛顿法是用二阶的海森矩阵的逆矩阵求解。相对而言，使用牛顿法收敛更快（迭代更少次数）。但是每次迭代的时间比梯度下降法长。

梯度下降法： ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%28k%2B1%29%7D%3Dx%5E%7B%28k%29%7D-%5Clambda+%5Cnabla+f%28x%5E%7Bk%7D%29)

牛顿法： ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%28k%2B1%29%7D%3Dx%5E%7B%28k%29%7D-%5Clambda+%28H%5E%7B%28k%29%7D%29%5E%7B-1%7D+%5Cnabla+f%28x%5E%7Bk%7D%29)

如下图是一个最小化一个目标方程的例子，红色曲线是利用牛顿法迭代求解，绿色曲线是利用梯度下降法求解。

![img](https://pic4.zhimg.com/80/v2-a25a1119558a899809d5f254f3ce2ce7_1440w.jpg)

至于为什么牛顿法收敛更快，通俗来说梯度下降法每次只从你当前所处位置选一个坡度最大的方向走一步，牛顿法在选择方向时，不仅会考虑坡度是否够大，还会考虑你走了一步之后，坡度是否会变得更大。所以，可以说牛顿法比梯度下降法看得更远一点，能更快地走到最底部。更多的可见：最优化问题中，[牛顿法为什么比梯度下降法求解需要的迭代次数更少？](https://www.zhihu.com/question/19723347)

------

## **3： 拟牛顿法的思路**

在牛顿法的迭代中，需要计算海森矩阵的逆矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H%5E%7B-1%7D) ，这一计算比较复杂，考虑用一个 ![[公式]](https://www.zhihu.com/equation?tex=n) 阶矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_k%3DG%28x%5E%7B%28k%29%7D%29) 来近似代替 ![[公式]](https://www.zhihu.com/equation?tex=H_k%5E%7B-1%7D%3DH%5E%7B-1%7D%28x%5E%7B%28k%29%7D%29) 。这就是拟牛顿法的基本想法。

要找到近似的替代矩阵，必定要和 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 有类似的性质。先看下牛顿法迭代中海森矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 满足的条件。首先 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 满足以下关系：

取 ![[公式]](https://www.zhihu.com/equation?tex=x%3Dx%5E%7B%5Cleft%28k-1%5Cright%29%7D) ，由
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+%5Cnabla+f%5Cleft%28x%5Cright%29%3Dg_%7Bk%7D%2BH_%7Bk%7D%5Cleft%28x-x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%5Cend%7Balign%2A%7D+%5C%5C)

得
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+g_%7Bk-1%7D-g_%7Bk%7D%3DH_%7Bk%7D%5Cleft%28x%5E%7B%5Cleft%28k-1%5Cright%29%7D-x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29%5Cend%7Balign%2A%7D+%5C%5C)
记 ![[公式]](https://www.zhihu.com/equation?tex=y_%7Bk%7D%3Dg_%7Bk%7D-g_%7Bk-1%7D%EF%BC%8C%5Cdelta_%7Bk%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D-x%5E%7B%5Cleft%28k-1%5Cright%29%7D) ，则
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+y_%7Bk-1%7D%3DH_%7Bk%7D%5Cdelta_%7Bk-1%7D+%5C%5C+%26+H_%7Bk%7D%5E%7B-1%7Dy_%7Bk-1%7D%3D%5Cdelta_%7Bk-1%7D%5Cend%7Balign%2A%7D+%5C%5C)

称为拟牛顿条件(Secant equation)。



**注：在李航老师《统计机器学习》附录B中，取的是** ![[公式]](https://www.zhihu.com/equation?tex=x%3Dx%5E%7B%28k%2B1%29%7D) **，得到的拟牛顿条件是** ![[公式]](https://www.zhihu.com/equation?tex=H_%7Bk%7D%5E%7B-1%7Dy_%7Bk%7D%3D%5Cdelta_%7Bk%7D) **，但是用** ![[公式]](https://www.zhihu.com/equation?tex=x%3Dx%5E%7B%28k-1%29%7D) **的到的拟牛顿条件和下面推导吻合，但还没找到原因，还望高手指教。**



其次，如果 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 是正定的（ ![[公式]](https://www.zhihu.com/equation?tex=H_k%5E%7B-1%7D) 也是正定的），那么保证牛顿法的搜索方向 ![[公式]](https://www.zhihu.com/equation?tex=p_k) 是下降方向。这是因为搜索方向是 ![[公式]](https://www.zhihu.com/equation?tex=p_k%3D-H_k%5E%7B-1%7Dg_k) ，
由
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D-H_%7Bk%7D%5E%7B-1%7Dg_%7Bk%7D+%5Cend%7Balign%2A%7D+%5C%5C)

有
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+x%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D-%5Clambda+H_%7Bk%7D%5E%7B-1%7D+g_%7Bk%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda+p_%7Bk%7D+%5Cend%7Balign%2A%7D%5C%5C)

则 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 在 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%5Cright%29%7D) 的泰勒展开可近似为
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+f%5Cleft%28x%5Cright%29%3Df%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29-%5Clambda+g_%7Bk%7D%5E%7BT%7D+H_%7Bk%7D%5E%7B-1%7D+g_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)

由于 ![[公式]](https://www.zhihu.com/equation?tex=H_%7Bk%7D%5E%7B-1%7D) 正定，故 ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%7D%5E%7BT%7D+H_%7Bk%7D%5E%7B-1%7D+g_%7Bk%7D+%3E+0) 。当 ![[公式]](https://www.zhihu.com/equation?tex=%5Clambda) 为一个充分小的正数时，有 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29+%3C+f%5Cleft%28x%5E%7B%5Cleft%28x%5Cright%29%7D%5Cright%29) ，即搜索方向 ![[公式]](https://www.zhihu.com/equation?tex=p_%7Bk%7D) 是下降方向。

因此拟牛顿法将 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 作为 ![[公式]](https://www.zhihu.com/equation?tex=H_k%5E%7B-1%7D) 近似。要求 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 满足同样的条件。首先，每次迭代矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 是正定的。同时， ![[公式]](https://www.zhihu.com/equation?tex=G_k) 满足下面的拟牛顿条件：
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26G_%7Bk%2B1%7Dy_k%3D%5Cdelta_k%5Cend%7Balign%2A%7D+%5C%5C)

按照拟牛顿条件，在每次迭代中可以选择更新矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D) ：
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26G_%7Bk%2B1%7D%3DG_k%2B%5CDelta+G_k%5Cend%7Balign%2A%7D+%5C%5C)

这种选择有一定的灵活性，因此有很多具体的实现方法，下面介绍Broyden类拟牛顿法。

------

## **4： DFP(Davidon-Fletcher-Powell)算法(DFP algorithm)**

DFP算法中选择 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%7D) 作为 ![[公式]](https://www.zhihu.com/equation?tex=H_%7Bk%7D%5E%7B-1%7D) 的近似，假设每一步迭代中矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D) 是由 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%7D) 加上两个附加项构成，即
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+G_%7Bk%2B1%7D%3DG_%7Bk%7D%2BP_%7Bk%7D%2BQ_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)

其中， ![[公式]](https://www.zhihu.com/equation?tex=P_%7Bk%7D) 与 ![[公式]](https://www.zhihu.com/equation?tex=Q_%7Bk%7D) 是待定矩阵。则
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+G_%7Bk%2B1%7Dy_%7Bk%7D%3DG_%7Bk%7Dy_%7Bk%7D%2BP_%7Bk%7Dy_%7Bk%7D%2BQ_%7Bk%7Dy_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)

为使 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D) 满足拟牛顿条件，可使 ![[公式]](https://www.zhihu.com/equation?tex=P_%7Bk%7D) 与 ![[公式]](https://www.zhihu.com/equation?tex=Q_%7Bk%7D) 满足
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+P_%7Bk%7Dy_%7Bk%7D%3D%5Cdelta_%7Bk%7D+%5C%5C+%26+Q_%7Bk%7Dy_%7Bk%7D%3D-G_%7Bk%7Dy_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)

可取
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+P_%7Bk%7D%3D+%5Cdfrac%7B%5Cdelta_%7Bk%7D+%5Cdelta_%7Bk%7D%5E%7BT%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7D+y_%7Bk%7D%7D+%5C%5C+%26+Q_%7Bk%7D%3D-+%5Cdfrac%7BG_%7Bk%7Dy_%7Bk%7Dy_%7Bk%7D%5E%7BT%7DG_%7Bk%7D%7D%7By_%7Bk%7D%5E%7BT%7DG_%7Bk%7Dy_%7Bk%7D%7D%5Cend%7Balign%2A%7D%5C%5C)
可得矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D) 的迭代公式
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+G_%7Bk%2B1%7D%EF%BC%9DG_%7Bk%7D%2B%5Cdfrac%7B%5Cdelta_%7Bk%7D+%5Cdelta_%7Bk%7D%5E%7BT%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7D+y_%7Bk%7D%7D-+%5Cdfrac%7BG_%7Bk%7Dy_%7Bk%7Dy_%7Bk%7D%5E%7BT%7DG_%7Bk%7D%7D%7By_%7Bk%7D%5E%7BT%7DG_%7Bk%7Dy_%7Bk%7D%7D%5Cend%7Balign%2A%7D%5C%5C)

可以证明，如果初始矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_%7B0%7D) 是正定的，则迭代过程中的每个矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%7D) 都是正定的。

> **DFP算法**：
> 输入：目标函数 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) ，梯度 ![[公式]](https://www.zhihu.com/equation?tex=g%5Cleft%28x%5Cright%29%3D%5Cnabla+f%5Cleft%28x%5Cright%29) ，精度要求 ![[公式]](https://www.zhihu.com/equation?tex=%5Cvarepsilon)
> 输出： ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 的极小点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D)
> \1. 取初始点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%280%5Cright%29%7D) ，取 ![[公式]](https://www.zhihu.com/equation?tex=G_%7B0%7D) 为正定矩阵，置 ![[公式]](https://www.zhihu.com/equation?tex=k%3D0)
> \2. 计算 ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%7D%3Dg%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) ， 若 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7Cg_%7Bk%7D%5C%7C+%3C+%5Cvarepsilon) 则停止计算，得近似解 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D) ；否则，转3.
> \3. 置 ![[公式]](https://www.zhihu.com/equation?tex=p_%7Bk%7D%3D-G_%7Bk%7Dg_%7Bk%7D)
> \4. 一维搜索，求 ![[公式]](https://www.zhihu.com/equation?tex=%5Clambda_%7Bk%7D) 使
> ![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+f%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda_%7Bk%7Dp_%7Bk%7D%5Cright%29%3D%5Cmin_%7B%5Clambda+%5Cgeq+0%7D+f%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda+p_%7Bk%7D%5Cright%29%5Cend%7Balign%2A%7D%5C%5C)
> \5. 置 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda+p_%7Bk%7D)
> \6. 计算 ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%2B1%7D%3Dg%5Cleft%28x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%5Cright%29) ，若 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7Cg_%7Bk%2B1%7D%5C%7C+%3C+%5Cvarepsilon) 则停止计算，近似解 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D%3Dx%5E%7B%5Cleft%28k%2B1%5Cright%29%7D) ；否则，计算
> ![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+G_%7Bk%2B1%7D%EF%BC%9DG_%7Bk%7D%2B%5Cdfrac%7B%5Cdelta_%7Bk%7D+%5Cdelta_%7Bk%7D%5E%7BT%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7D+y_%7Bk%7D%7D-+%5Cdfrac%7BG_%7Bk%7Dy_%7Bk%7Dy_%7Bk%7D%5E%7BT%7DG_%7Bk%7D%7D%7By_%7Bk%7D%5E%7BT%7DG_%7Bk%7Dy_%7Bk%7D%7D%5Cend%7Balign%2A%7D%5C%5C)
> \7. 置 ![[公式]](https://www.zhihu.com/equation?tex=k%3Dk%2B1) ，转3.



## **5： BFGS(Broyden-Fletcher-Goldfard-Shano)算法(BFGS algorithm)**

DFP是用 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 逼近海赛矩阵的逆矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H_%7Bk%7D%5E%7B-1%7D) ，而BFGS算法中选择 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%7D) 逼近海赛矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H_%7Bk%7D) ，相应的拟牛顿条件
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+B_%7Bk%2B1%7D+%5Cdelta_%7Bk%7D+%3D+y_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)
假设每一步迭代中矩阵 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%2B1%7D) 是由 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%7D) 加上两个附加项构成，即
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+B_%7Bk%2B1%7D%3DB_%7Bk%7D%2BP_%7Bk%7D%2BQ_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)

其中， ![[公式]](https://www.zhihu.com/equation?tex=P_%7Bk%7D) 与 ![[公式]](https://www.zhihu.com/equation?tex=Q_%7Bk%7D) 是待定矩阵。则
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+B_%7Bk%2B1%7Dy_%7Bk%7D%3DB_%7Bk%7Dy_%7Bk%7D%2BP_%7Bk%7Dy_%7Bk%7D%2BQ_%7Bk%7Dy_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)

为使 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%2B1%7D) 满足拟牛顿条件，可使 ![[公式]](https://www.zhihu.com/equation?tex=P_%7Bk%7D) 与 ![[公式]](https://www.zhihu.com/equation?tex=Q_%7Bk%7D) 满足
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+P_%7Bk%7D%5Cdelta_%7Bk%7D%3Dy_%7Bk%7D+%5C%5C+%26+Q_%7Bk%7D%5Cdelta_%7Bk%7D%3D-B_%7Bk%7Dy_%7Bk%7D%5Cdelta_%7Bk%7D%5Cend%7Balign%2A%7D%5C%5C)
可取
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+P_%7Bk%7D%3D+%5Cdfrac%7By_%7Bk%7Dy_%7Bk%7D%5E%7BT%7D%7D%7By_%7Bk%7D%5E%7BT%7D%5Cdelta_%7Bk%7D+%7D+%5C%5C+%26+Q_%7Bk%7D%3D-+%5Cdfrac%7BB_%7Bk%7D%5Cdelta_%7Bk%7D%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%5Cdelta_%7Bk%7D%7D%5Cend%7Balign%2A%7D%5C%5C)

可得矩阵 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%2B1%7D) 的迭代公式
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+B_%7Bk%2B1%7D%EF%BC%9DB_%7Bk%7D%2B%5Cdfrac%7By_%7Bk%7Dy_%7Bk%7D%5E%7BT%7D%7D%7By_%7Bk%7D%5E%7BT%7D%5Cdelta_%7Bk%7D+%7D-+%5Cdfrac%7BB_%7Bk%7D%5Cdelta_%7Bk%7D%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%5Cdelta_%7Bk%7D%7D%5Cend%7Balign%2A%7D%5C%5C)
可以证明，如果初始矩阵 ![[公式]](https://www.zhihu.com/equation?tex=B_%7B0%7D) 是正定的，则迭代过程中的每个矩阵 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%7D) 都是正定的。

> **BFGS算法**：
> 输入：目标函数 ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) ，梯度 ![[公式]](https://www.zhihu.com/equation?tex=g%5Cleft%28x%5Cright%29%3D%5Cnabla+f%5Cleft%28x%5Cright%29) ，精度要求 ![[公式]](https://www.zhihu.com/equation?tex=%5Cvarepsilon)
> 输出： ![[公式]](https://www.zhihu.com/equation?tex=f%5Cleft%28x%5Cright%29) 的极小点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D)
> \1. 取初始点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%280%5Cright%29%7D) ，取 ![[公式]](https://www.zhihu.com/equation?tex=B_%7B0%7D) 为正定矩阵，置 ![[公式]](https://www.zhihu.com/equation?tex=k%3D0)
> \2. 计算 ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%7D%3Dg%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%5Cright%29) ，若 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7Cg_%7Bk%7D%5C%7C+%3C+%5Cvarepsilon) 则停止计算，得近似解 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D) ；否则，转3.
> \3. 由 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%7Dp_%7Bk%7D%3D-g_%7Bk%7D) 求出 ![[公式]](https://www.zhihu.com/equation?tex=p_%7Bk%7D)
> \4. 一维搜索，求 ![[公式]](https://www.zhihu.com/equation?tex=%5Clambda_%7Bk%7D) 使
> ![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+f%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda_%7Bk%7Dp_%7Bk%7D%5Cright%29%3D%5Cmin_%7B%5Clambda+%5Cgeq+0%7D+f%5Cleft%28x%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda+p_%7Bk%7D%5Cright%29%5Cend%7Balign%2A%7D%5C%5C)
> \5. 置 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%3Dx%5E%7B%5Cleft%28k%5Cright%29%7D%2B%5Clambda+p_%7Bk%7D)
> \6. 计算 ![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%2B1%7D%3Dg%5Cleft%28x%5E%7B%5Cleft%28k%2B1%5Cright%29%7D%5Cright%29) ，若 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7Cg_%7Bk%2B1%7D%5C%7C+%3C+%5Cvarepsilon) ，则停止计算，近似解 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%7B%2A%7D%3Dx%5E%7B%5Cleft%28k%2B1%5Cright%29%7D) ；否则，计算
> ![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+B_%7Bk%2B1%7D%EF%BC%9DB_%7Bk%7D%2B%5Cdfrac%7By_%7Bk%7Dy_%7Bk%7D%5E%7BT%7D%7D%7By_%7Bk%7D%5E%7BT%7D%5Cdelta_%7Bk%7D+%7D-+%5Cdfrac%7BB_%7Bk%7D%5Cdelta_%7Bk%7D%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%5Cdelta_%7Bk%7D%7D%5Cend%7Balign%2A%7D%5C%5C)
> \7. 置 ![[公式]](https://www.zhihu.com/equation?tex=k%3Dk%2B1) ，转3.

------

## **6： Broyden类算法(Broyden's algorithm)**

我们可以从BFGS算法矩阵 ![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%2B1%7D%EF%BC%9DB_%7Bk%7D%2B%5Cdfrac%7By_%7Bk%7Dy_%7Bk%7D%5E%7BT%7D%7D%7By_%7Bk%7D%5E%7BT%7D%5Cdelta_%7Bk%7D+%7D-+%5Cdfrac%7BB_%7Bk%7D%5Cdelta_%7Bk%7D%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7DB_%7Bk%7D%5Cdelta_%7Bk%7D%7D) 的迭代公式得到BFGS算法关于 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 的迭代公式。

记
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+G_%7Bk%7D%3DB_%7Bk%7D%5E%7B-1%7D%2C%5Cquad+G_%7Bk%2B1%7D%3DB_%7Bk%2B1%7D%5E%7B-1%7D%5Cend%7Balign%2A%7D%5C%5C)

两次应用Sherman-Morrison公式，得
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+G_%7Bk%EF%BC%8B1%7D%3D%5Cleft%28I-+%5Cdfrac%7B%5Cdelta_%7Bk%7Dy_%7Bk%7D%5E%7BT%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7Dy_%7Bk%7D%7D%5Cright%29G_%7Bk%7D%5Cleft%28I-%5Cdfrac%7B%5Cdelta_%7Bk%7Dy_%7Bk%7D%5E%7BT%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7Dy_%7Bk%7D%7D%5Cright%29%5E%7BT%7D%2B%5Cdfrac%7B%5Cdelta_%7Bk%7D%5Cdelta_%7Bk%7D%5E%7BT%7D%7D%7B%5Cdelta_%7Bk%7D%5E%7BT%7Dy_%7Bk%7D%7D%5Cend%7Balign%2A%7D%5C%5C)

称为BFGS算法关于 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%7D) 的迭代公式。

其中Sherman-Morrison公式：假设 ![[公式]](https://www.zhihu.com/equation?tex=A) 是 ![[公式]](https://www.zhihu.com/equation?tex=n) 阶可逆矩阵， ![[公式]](https://www.zhihu.com/equation?tex=u%2Cv) 是 ![[公式]](https://www.zhihu.com/equation?tex=n) 维向量，且 ![[公式]](https://www.zhihu.com/equation?tex=A%2Buv%5ET) 也是可逆矩阵，则：
![[公式]](https://www.zhihu.com/equation?tex=%28A%2Buv%5ET%29%5E%7B-1%7D%3DA%5E%7B-1%7D-%5Cfrac%7BA%5E%7B-1%7Duv%5ETA%5E%7B-1%7D%7D%7B1%2Bv%5ETA%5E%7B-1%7Du%7D%5C%5C)

令由DFP算法 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%7D) 的迭代公式得到的 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D) 记作 ![[公式]](https://www.zhihu.com/equation?tex=G%5E%7BDFP%7D) ，由BFGS算法 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%7D) 的迭代公式得到的 ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D) 记作 ![[公式]](https://www.zhihu.com/equation?tex=G%5E%7BBFGS%7D) ，由于 ![[公式]](https://www.zhihu.com/equation?tex=G%5E%7BDFP%7D) 和 ![[公式]](https://www.zhihu.com/equation?tex=G%5E%7BBFGS%7D) 均满足拟牛顿条件，则两者的线性组合
![[公式]](https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+%5C%5C%26+G_%7Bk%2B1%7D%3D%5Calpha+G%5E%7BDFP%7D%2B%5Cleft%281-%5Calpha%5Cright%29+G%5E%7BBFGS%7D%5Cend%7Balign%2A%7D%5C%5C)

也满足拟牛顿条件，而且是正定的。其中， ![[公式]](https://www.zhihu.com/equation?tex=0+%5Cleq+%5Calpha+%5Cleq+1) 。该类算法称为Broyden类算法。

------

## **7： 参考文献**

李航：《统计学习方法》，清华大学出版社

[Jacobian矩阵和Hessian矩阵](https://link.zhihu.com/?target=http%3A//jacoxu.com/jacobian%E7%9F%A9%E9%98%B5%E5%92%8Chessian%E7%9F%A9%E9%98%B5/)

[梯度下降（Gradient Descent）小结](https://link.zhihu.com/?target=https%3A//www.cnblogs.com/pinard/p/5970503.html)

[https://hackernoon.com/gradient-descent-aynk-7cbe95a778da](https://link.zhihu.com/?target=https%3A//hackernoon.com/gradient-descent-aynk-7cbe95a778da)

[牛顿法与拟牛顿法学习笔记](https://link.zhihu.com/?target=https%3A//blog.csdn.net/itplus/article/details/21896453)

编辑于 2018-06-18 11:04

机器学习

统计学习方法（书籍）

最优化