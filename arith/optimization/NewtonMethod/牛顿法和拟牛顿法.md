# 牛顿法和拟牛顿法

[Pikachu5808](https://www.zhihu.com/people/pikachu5808)

清华本科 && EE转CS



189 人赞同了该文章

**牛顿法（Newton method）和拟牛顿法（quasi Newton method）是求解无约束最优化问题的常用方法，有收敛速度快的优点。牛顿法是迭代算法，每一步都需求解目标函数的海塞矩阵（Hessian Matrix），计算比较复杂。拟牛顿法通过正定矩阵近似海塞矩阵的逆矩阵或海塞矩阵，简化了这一计算过程。**

------

## **1、牛顿法**

## **1.1、原理**

牛顿法的原理是使用函数 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) 的泰勒级数的前面几项来寻找方程 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3D0) 的根。

将函数 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) 在 ![[公式]](https://www.zhihu.com/equation?tex=x_0) 处展开成泰勒级数:

![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3Df%28x_0%29%2Bf%5E%7B%27%7D%28x_0%29%28x-x_0%29%2B%5Cfrac%7B1%7D%7B2%7Df%5E%7B%27%27%7D%28x_0%29%28x-x_0%29%5E2%2B%5Cdots%5C%5C)

取其线性部分，作为 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) 的近似，则可用 ![[公式]](https://www.zhihu.com/equation?tex=f%28x_0%29%2Bf%5E%7B%27%7D%28x_0%29%28x-x_0%29%3D0) 的解来近似 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3D0) 的解，其解为 ![[公式]](https://www.zhihu.com/equation?tex=x_1%3Dx_0-%5Cfrac%7Bf%28x_0%29%7D%7Bf%5E%7B%27%7D%28x_0%29%7D) 。

由于对 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) 的近似只是一阶展开，因此 ![[公式]](https://www.zhihu.com/equation?tex=x_1) 并非 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29%3D0) 的解，只能说 ![[公式]](https://www.zhihu.com/equation?tex=f%28x_1%29) 比 ![[公式]](https://www.zhihu.com/equation?tex=f%28x_0%29) 更接近0。于是，考虑迭代求解：

![[公式]](https://www.zhihu.com/equation?tex=x_%7Bn%2B1%7D%3Dx_%7Bn%7D-%5Cfrac%7Bf%28x_n%29%7D%7Bf%5E%7B%27%7D%28x_n%29%7D%5C%5C)

迭代过程可参考下图：

![img](https://pic1.zhimg.com/v2-dac11d82ecb2566f54ce8b518d51293c_b.jpg)

## **1.2、求解最优化问题**

对于无约束最优化问题 ![[公式]](https://www.zhihu.com/equation?tex=%5Cunderset+%7Bx%5Cin+%5Cmathbf+R%5En%7D%7B%5Cmin%7D+f%28x%29) ，可根据极小点的必要条件 ![[公式]](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%29%3D0) 采用牛顿法求解：

![[公式]](https://www.zhihu.com/equation?tex=x_%7Bk%2B1%7D%3Dx_%7Bk%7D-H%5E%7B-1%7D_%7Bk%7Dg_k%5C%5C)

其中， ![[公式]](https://www.zhihu.com/equation?tex=g_k%3Dg%28x_k%29%3D%5Cnabla+f%28x_k%29) 是 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) 的梯度向量在点 ![[公式]](https://www.zhihu.com/equation?tex=x_k) 的值； ![[公式]](https://www.zhihu.com/equation?tex=H_k%3DH%28x_k%29) ， ![[公式]](https://www.zhihu.com/equation?tex=H%28x%29%3D%5B%5Cfrac+%7B%5Cpartial%5E2f%7D%7B%5Cpartial+x_i+%5Cpartial+x_j%7D%5D_%7Bn%5Ctimes+n%7D) 是 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) 的海塞矩阵。

输入：目标函数 ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) ，梯度 ![[公式]](https://www.zhihu.com/equation?tex=g%28x%29%3D%5Cnabla+f%28x%29) ，海塞矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H%28x%29) ，精度要求 ![[公式]](https://www.zhihu.com/equation?tex=%5Cepsilon) ；

输出： ![[公式]](https://www.zhihu.com/equation?tex=f%28x%29) 的极小点 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%2A) 。

（1）取初始点 ![[公式]](https://www.zhihu.com/equation?tex=x_0) ，置 ![[公式]](https://www.zhihu.com/equation?tex=k%3D0)

（2）计算 ![[公式]](https://www.zhihu.com/equation?tex=g_k) ，若 ![[公式]](https://www.zhihu.com/equation?tex=%7C%7Cg_k%7C%7C%3C%5Cepsilon) ，则 ![[公式]](https://www.zhihu.com/equation?tex=x%5E%2A%3Dx_k) ，停止计算；否则转（3）

（3）计算 ![[公式]](https://www.zhihu.com/equation?tex=H_k) ，令 ![[公式]](https://www.zhihu.com/equation?tex=x_%7Bk%2B1%7D%3Dx_%7Bk%7D-H%5E%7B-1%7D_%7Bk%7Dg_k)

（4）置 ![[公式]](https://www.zhihu.com/equation?tex=k%3Dk%2B1) ，转（2）

注：第（3）步中，涉及到 ![[公式]](https://www.zhihu.com/equation?tex=H%5E%7B-1%7D_%7Bk%7D) 的计算，实际应用中，通常并不直接对 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 进行求逆，而是将其转化为求解线性代数方程组 ![[公式]](https://www.zhihu.com/equation?tex=H_k+d_k%3D-g_k) ，此时可根据系数矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 的性态来选择合适的迭代法，如预条件共轭梯度法（PCG）、代数多重网格法（AMG）等。

## **1.3、小结**

当目标函数是二次函数时，海塞矩阵退化成一个常数矩阵，从任一初始点出发，牛顿法可一步到达，因此它是一种具有二次收敛性的算法。对于非二次函数，若函数的二次性态较强，或迭代点已进入极小点的邻域，则其收敛速度也是很快的，这是牛顿法的主要优点。

牛顿法的迭代公式中由于没有步长因子，是定步长迭代，对于非二次型目标函数，有时会使函数值上升，即出现 ![[公式]](https://www.zhihu.com/equation?tex=f%28x_%7Bk%2B1%7D%29%3Ef%28x_k%29) 的情况，更甚者，可能出现迭代点列 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7Bx_k%5C%7D) 发散而导致计算失败的情况。为解决这个问题，出现了“阻尼牛顿法”，增加一个步长因子 ![[公式]](https://www.zhihu.com/equation?tex=%5Clambda_k) ，将算法流程（3）中的计算公式修改为：

![[公式]](https://www.zhihu.com/equation?tex=x_%7Bk%2B1%7D%3Dx_%7Bk%7D-%5Clambda_k+H%5E%7B-1%7D_%7Bk%7Dg_k%5C%5C)

牛顿法的另一个弊病在于，每一次迭代都要计算 ![[公式]](https://www.zhihu.com/equation?tex=H%5E%7B-1%7D) ，这一步计算比较复杂，下一节的拟牛顿法将解决这个问题。

## **2、拟牛顿法**

如上节所说，牛顿法虽然收敛速度快，但是需要计算海塞矩阵的逆矩阵 ![[公式]](https://www.zhihu.com/equation?tex=H%5E%7B-1%7D) ，而且有时目标函数的海塞矩阵无法保持正定，从而使得牛顿法失效。为了克服这两个问题，人们提出了拟牛顿法。这个方法的基本思想是：不用二阶偏导数而构造出可以近似海塞矩阵（或海塞矩阵的逆）的正定对称阵。不同的构造方法就产生了不同的拟牛顿法。

下面我们先推导一下拟牛顿条件，它给“对海塞矩阵（或海塞矩阵的逆）做近似”提供了理论指导，指出了用来近似的矩阵应该满足的条件。

## **2.1、拟牛顿条件**

对 ![[公式]](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%29) 做泰勒展开我们得到了以下近似：

![[公式]](https://www.zhihu.com/equation?tex=%5Cnabla+f%28x%29%3Dg_k%2BH_k%28x-x_k%29%5C%5C)

取 ![[公式]](https://www.zhihu.com/equation?tex=x%3Dx_%7Bk%2B1%7D) ，即得：

![[公式]](https://www.zhihu.com/equation?tex=g_%7Bk%2B1%7D-g_k%3DH_k%28x_%7Bk%2B1%7D-x_k%29%5C%5C)

记 ![[公式]](https://www.zhihu.com/equation?tex=y_k%3Dg_%7Bk%2B1%7D-g_k) ， ![[公式]](https://www.zhihu.com/equation?tex=%5Cdelta_k%3Dx_%7Bk%2B1%7D-x_k) ，则：

![[公式]](https://www.zhihu.com/equation?tex=y_k%3DH_k%5Cdelta_k+%5C%5C+%E6%88%96%5C%5C+H%5E%7B-1%7D_k+y_k%3D%5Cdelta_k)

以上即为拟牛顿条件。

在拟牛顿法中，选择 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 作为 ![[公式]](https://www.zhihu.com/equation?tex=H%5E%7B-1%7D_k) 的近似或选择 ![[公式]](https://www.zhihu.com/equation?tex=B_k) 作为 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 的近似，并且使得它们满足上述拟牛顿条件即可。

## **2.2、DFP算法**

DFP算法用 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 作为 ![[公式]](https://www.zhihu.com/equation?tex=H%5E%7B-1%7D_k) 的近似，这里我们直接给出计算公式：

![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D%3DG_k%2B%5Cfrac+%7B%5Cdelta_k+%5Cdelta%5ET_k%7D%7B%5Cdelta%5ET_k+y_k%7D-%5Cfrac%7BG_ky_ky%5ET_kG_k%7D%7By%5ET_kG_ky_k%7D%5C%5C)

可以证明，如果初始矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_0) 是正定对称的，则迭代过程中的每个矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 都是正定对称的，一般取 ![[公式]](https://www.zhihu.com/equation?tex=G_0%3DI) 。

## **2.3、BFGS算法**

BFGS算法用 ![[公式]](https://www.zhihu.com/equation?tex=B_k) 作为 ![[公式]](https://www.zhihu.com/equation?tex=H_k) 的近似，与DFP相比，BFGS性能更佳。这里我们直接给出计算公式：

![[公式]](https://www.zhihu.com/equation?tex=B_%7Bk%2B1%7D%3DB_k%2B%5Cfrac+%7By_ky%5ET_k%7D%7By%5ET_k%5Cdelta_k%7D-%5Cfrac%7BB_k+%5Cdelta_k+%5Cdelta%5ET_k+B_k%7D%7B%5Cdelta%5ET_k+B_k+%5Cdelta_k%7D%5C%5C)

可以证明，如果初始矩阵 ![[公式]](https://www.zhihu.com/equation?tex=B_0) 是正定对称的，则迭代过程中的每个矩阵 ![[公式]](https://www.zhihu.com/equation?tex=B_k) 都是正定对称的，一般取 ![[公式]](https://www.zhihu.com/equation?tex=B_0%3DI) 。

若记 ![[公式]](https://www.zhihu.com/equation?tex=G_k%3DB%5E%7B-1%7D_k) ， ![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D%3DB%5E%7B-1%7D_%7Bk%2B1%7D) ，那么应用Sherman-Morrison公式可以将上述迭代公式改写为：

![[公式]](https://www.zhihu.com/equation?tex=G_%7Bk%2B1%7D%3D%28I-%5Cfrac%7B%5Cdelta_k+y%5ET_k%7D%7B%5Cdelta%5ET_k+y_k%7D%29G_k%28I-%5Cfrac%7B%5Cdelta_k+y%5ET_k%7D%7B%5Cdelta%5ET_k+y_k%7D%29%5ET%2B%5Cfrac%7B%5Cdelta_k+%5Cdelta%5ET_k%7D%7B%5Cdelta%5ET_k+y_k%7D%5C%5C)

这就是BFGS算法关于 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 的迭代公式。

## **2.4、L-BFGS算法**

在BFGS中，需要用到一个 ![[公式]](https://www.zhihu.com/equation?tex=N) 阶矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_k) ，当 ![[公式]](https://www.zhihu.com/equation?tex=N) 很大时，存储这个矩阵将消耗大量计算机资源。为了解决这个问题，减少BFGS迭代过程中所需的内存开销，就有了L-BFGS。

L-BFGS（Limited-memory BFGS或Limited-storage BFGS）对BFGS进行了近似，其基本思想是：不再存储完整的矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_k) ，而是存储计算过程中的向量序列 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7B%5Cdelta_k%5C%7D+%5C%7By_k%5C%7D) ，需要矩阵 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 时，利用向量序列 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7B%5Cdelta_k%5C%7D+%5C%7By_k%5C%7D) 的计算来代替。而且，向量序列 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7B%5Cdelta_k%5C%7D+%5C%7By_k%5C%7D) 也不是所有的都存储，而是保留最新的m个，每次计算 ![[公式]](https://www.zhihu.com/equation?tex=G_k) 时，只利用最新的m个向量序列 ![[公式]](https://www.zhihu.com/equation?tex=%5C%7B%5Cdelta_k%5C%7D+%5C%7By_k%5C%7D) 。这样一来，存储空间由 ![[公式]](https://www.zhihu.com/equation?tex=O%28N%5E2%29) 降至 ![[公式]](https://www.zhihu.com/equation?tex=O%28mN%29) 。

具体推导和计算细节，这里不赘述，读者可自行了解。

## **3、其它**

## **3.1、牛顿法和梯度下降法**

二者都是求解无约束最优化问题的常用方法，牛顿法是二阶收敛，梯度下降法是一阶收敛，所以牛顿法更快，下图形象化地显示了这一点：

![img](https://pic4.zhimg.com/80/v2-4980eec3aa27524f9bc70e57dafe56ab_1440w.jpg)

其中，红色路径代表牛顿法，绿色路径代表梯度下降法。

## **3.2、牛顿法和深度学习**

深度学习中，往往采用梯度下降法作为优化算子，而很少采用牛顿法，主要原因有以下几点：

1. 神经网络通常是非凸的，这种情况下，牛顿法的收敛性难以保证；

\2. 即使是凸优化，只有在迭代点离全局最优很近时，牛顿法才会体现出收敛快的优势；

\3. 可能被鞍点吸引。

------

## **参考文献**

[1] [无约束优化算法--牛顿法与拟牛顿法（DFP，BFGS，LBFGS） - ljy2013 - 博客园](https://link.zhihu.com/?target=https%3A//www.cnblogs.com/ljy2013/p/5129294.html)

[2] [自问自答1--为什么深度学习不采用牛顿法及其衍生算法作为优化算法？ - CodeTutor - CSDN博客](https://link.zhihu.com/?target=https%3A//blog.csdn.net/VictoriaW/article/details/71710280)

[3] [https://zh.wikipedia.org/wiki/%E7%89%9B%E9%A1%BF%E6%B3%95](https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%E7%89%9B%E9%A1%BF%E6%B3%95)

[4] [从梯度下降到拟牛顿法：详解训练神经网络的五大学习算法](https://link.zhihu.com/?target=https%3A//www.jiqizhixin.com/articles/2017-03-11-2)

[5] [梯度下降or拟牛顿法？](https://www.zhihu.com/question/46441403?sort=created)

[6] [牛顿法_百度百科](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E7%89%9B%E9%A1%BF%E6%B3%95/1384129%3Ffr%3Daladdin)

[7] [最优化问题中，牛顿法为什么比梯度下降法求解需要的迭代次数更少？](https://www.zhihu.com/question/19723347)

[8] [LBFGS方法推导 - 慢慢的回味](https://link.zhihu.com/?target=https%3A//liuxiaofei.com.cn/blog/lbfgs%E6%96%B9%E6%B3%95%E6%8E%A8%E5%AF%BC/)

[9] [Hessian矩阵与牛顿法 - 心灵智者AI - 博客园](https://link.zhihu.com/?target=https%3A//www.cnblogs.com/jiahenhe2/p/8086857.html)

[10] [泰勒级数_百度百科](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E6%B3%B0%E5%8B%92%E7%BA%A7%E6%95%B0/7289427%3Ffr%3Daladdin)

以上为本文的全部参考文献，对原作者表示感谢。

