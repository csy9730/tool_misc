# 线性同余算法

作者：皮皮关

链接：https://www.zhihu.com/question/27940474/answer/1373590377

来源：知乎

著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

## 一、线性同余算法

**算法描述**：给定一个初始数字（比如13），然后计算下一个数字：

​                 **下一个数字 = 当前数字 \* a + b**

其中a和b都是正整数。多位数乘法和加法四年级已经学过了  ：）

不过我还隐瞒了一部分，如果一直算数字会越来越大，要实用的话还得加一个取余的操作：

​                 **下一个数字 = （ 当前数字 \* a + b ）除以m的余数**

那a、b、m取什么值呢？可以让b取1，a取22695477，m取4、8、16、32等等（2的幂）都行。

m取8，初始数字为1，试一试：

1. (1 * 22695477 + 1) % 8 = 6,  （百分号%代表取余操作）
2. (6 * 22695477 + 1) % 8 = 7,
3. (7 * 22695477 + 1) % 8 = 4,
4. (4 * 22695477 + 1) % 8 = 5,
5. (5 * 22695477 + 1) % 8 = 2,
6. (2 * 22695477 + 1) % 8 = 3,
7. (3 * 22695477 + 1) % 8 = 0,
8. (0 * 22695477 + 1) % 8 = 1,
9. (1 * 22695477 + 1) % 8 = 6,
10. (6 * 22695477 + 1) % 8 = 7,
11. (7 * 22695477 + 1) % 8 = 4,
12. (4 * 22695477 + 1) % 8 = 5,
13. (5 * 22695477 + 1) % 8 = 2,
14. (2 * 22695477 + 1) % 8 = 3,
15. (3 * 22695477 + 1) % 8 = 0,
16. (0 * 22695477 + 1) % 8 = 1,
17. (1 * 22695477 + 1) % 8 = 6,
18. (6 * 22695477 + 1) % 8 = 7,

看出规律了，结果是6、7、4、5、2、3、0、1、6、7、4、5、2、3、0、1……不断循环。循环跨度是8，0~7全都出现了一遍。

m换成4：

1. (1 * 22695477 + 1) % 4 = 2,
2. (2 * 22695477 + 1) % 4 = 3,
3. (3 * 22695477 + 1) % 4 = 0,
4. (0 * 22695477 + 1) % 4 = 1,
5. (1 * 22695477 + 1) % 4 = 2,
6. (2 * 22695477 + 1) % 4 = 3,
7. (3 * 22695477 + 1) % 4 = 0,
8. (0 * 22695477 + 1) % 4 = 1,
9. (1 * 22695477 + 1) % 4 = 2,

结果是2、3、0、1、2、3、0、1……不断循环。循环跨度是4。0123全都出现了一遍。

先总结一下上面的规律：用这个算式，当你取了m以后，反复计算就会出现一个循环数列，而且循环的每一段，正好会把 0~m-1 无重复乱序遍历一遍。

以此类推，m可以取32、128、1024、2048、65536、2的[32次方](https://www.zhihu.com/search?q=32次方&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1373590377})甚至更大。实际常用的m就是2的32次方，即4294967296。

仔细想一想。

你可能会问，这和[随机数](https://www.zhihu.com/search?q=随机数&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1373590377})有什么关系？

## 二、线性同余如何用于随机数

答案是：如果m取的比较大，比如 2的32次方4294967296，那你就会得到一个循环跨度近43亿位的循环数列。43亿位循环跨度，对普通人来说相当于没循环。

进一步，我可以拿这个数列模拟**6面骰子**。方法是：每次计算后不告诉你x的值，只告诉你 (x % 6 + 1)的结果（百分号代表取余数，除以6余数是0~5，加1范围就是1~6），试试看：

> 5, 6, 1, 4, 5, 2, 1, 4, 3, 4, 5, 6, 3, 6, 5, 4, 1, 4, 3, 2, 5, 4, 5, 2, 1, 4, 1, 4, 1, 2

没什么规律了吧？就算知道了这30次投骰子的结果，也根本猜不出下一个数字是什么。因为这个序列的背后，其实是以下序列：

> 22695478, 2156045615, 2867233980, 71484141, 2911408402, 2613937339, 1153135800, 420428313, 1503962414……

这是一个循环跨度43亿、取值范围0~43亿的序列，能直接看出规律来的只能是上帝了。

**这个算法可以保证两点：**

**1、**连续投骰子的过程中，你很难知道下一个数字是什么。

**2、**只要投的次数足够多，出现1~6的概率是一样的。不用担心某个数字多，某个数字少。

因此，“线性同余伪随机”算法可以直接用于日常软件、硬件、游戏的设计。且它可以方便地指定随机数的范围，所以使用起来也非常方便。

## 三、线性同余伪随机算法的背后

对于我们外行来说，理解线性同余伪随机算法的公式、性质、用途就足够了。但真正的问题在于——参数a和b到底是怎么确定的？任意的a和b也可以吗？它的背后到底是什么原理？

a、b和m确实不能随意取值，理论中对a、b、m有一定要求，比如a和b要尽量互质。解释这个问题超出了本回答的范围，好在咱大知乎不缺数学高手。下面这篇文章对“线性同余伪随机算法”做了概括性的探讨，不讨厌数学的同学们可以读一读：

[崔军辉：随机算法线性同余法的理解115 赞同 · 9 评论文章![img](https://pic4.zhimg.com/v2-63f956d542cabca69771056a2ca5f11b_180x120.jpg)](https://zhuanlan.zhihu.com/p/36301602)

线性同余伪随机算法的理论基础是**数论**， 而数论是最古老的数学分支，这一古老学科的研究对象非常明确：整数的性质。

线性同余伪随机算法属于初等数论，它只是对数论中的同余、互质等理论的基本应用，大概不算非常高深。它与“韩信点兵”问题师出同门：

> 在一千多年前的《[孙子算经](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%AD%99%E5%AD%90%E7%AE%97%E7%BB%8F)》中，有这样一道算术题：“今有物不知其数，三三数之剩二，五五数之剩三，七七数之剩二，问物几何？”按照今天的话来说：一个数除以3余2，除以5余3，除以7余2，求这个数。
> 这样的问题，也有人称为“韩信点兵”。它形成了一类问题，也就是[初等数论](https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%88%9D%E7%AD%89%E6%95%B0%E8%AE%BA)中的解同余式。

数论中的一些研究对象，特别是**质数**的性质与规律，不仅是数学王国里的明珠，也已经构成了现代信息社会的基础——SSH加密算法与各种伪随机算法都是基于数论，我们在网上几乎每一步操作都离不开它们。

在数学王国里摘一片叶子，拿到现实世界，就成了一片汪洋。



————————**附录**：线性同余伪随机算法，常用取值————————

![img](https://pic3.zhimg.com/50/v2-3d4e6a2088ef96960a78245042f3496e_720w.jpg?source=1940ef5c)![img](https://pic3.zhimg.com/80/v2-3d4e6a2088ef96960a78245042f3496e_1440w.jpg?source=1940ef5c)



[发布于 2020-07-31 15:32](http://www.zhihu.com/question/27940474/answer/1373590377)