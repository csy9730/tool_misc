# 定积分数值计算


- Newton-Cotes积分法
    - 梯形积分
    - 三点辛普森算法
    - 5点科特斯算法
    - 复合辛普森算法
    - 自适应辛普森算法
    - 龙贝格算法
- Gauss积分法
    - Guass-lengendre
    - Kronrod积分法


## 问题


$$
I=\int_a^b{f(x)dx}
$$




## Newton-Cotes积分法

对区间进行均匀采样，对采样点进行多项式插值，计算积分。


- n=1， 两点积分公式（梯形公式）
- n=2， 3点积分公式，simpson公式
- n=3， 4点积分公式
- n=4， 5点积分公式，科特斯公式
- n=5， 6点积分公式
- n=6， 7点积分公式
- n=7， 8点积分公式
- n=8， 9点积分公式

当n=8，公式出现负系数，不再稳定。

当n为偶数，公式有n+1次代数精度。

所以，平时常用的n=1，2，4。


### Trapezoidal Integral Approximation

梯形公式
$$
I=\frac{b-a}{2}[f(a)+f(b)]
$$

### **中矩形公式**
一点积分公式？ 

**中矩形公式**（简称**矩形公式**）
$$
I=(b-a)f(\frac{a+b}{2})
$$


### simpson  2order


$$
I=\frac{b-a}{6}[f(a)+4f(\frac{a+b}{2})+f(b)]
$$


辛普森公式，只有三次代数精度. 对于四阶多项式不适用，难以保证误差。

### 3 order

$$
I=\frac{b-a}{8}[f(a)+3f(a+h)+3f(a+2h)+f(b)]\\
h=\frac{b-a}{3}
$$

只有三次代数精度,  不推荐使用。


### 柯特斯公式

布尔法则,  4 order牛顿-柯特斯公式（5点积分）


$$
I=\frac{b-a}{90}[7f(a)+32f(a+h)+12f(a+2h)+32f(a+3h)+7f(b)]\\
h=\frac{b-a}{4}
$$


### 牛顿-柯特斯公式

$$
I_n=(b-a)\sum_{k=0}^n{C_k^nf(x+th)}\\
h=\frac{b-a}{n}\\
C_k^n=\frac{(-1)^{n-k}}{nk!(n-k)!}\prod_{j=0,j\neq k}^n{(t-j)dt}
$$



牛顿-柯特斯公式在N》=8时，系数是负的，不具有稳定性。



对于2阶积分与3阶积分具有相同的误差阶；4阶积分与5阶积分具有相同的误差阶。对于阶数更多的积分也一样。因此优先使用偶数阶的积分。



### 复合梯形法
composite trapezoidal rule

对区间[a,b] 进行n等分, 得到n个子区间[x_n,x_n+1], 对每个区间计算梯形公式
$$
I=\frac{h}{2}[f(a)+2\sum_{k=1}^{n-1}{f(x_k)}+f(b)]\\
h=\frac{b-a}{n}\\
x_k=a+kh
$$

误差阶是$h^2$

### 复合simpson
composite Simpson rule

把区间n等分, 得到n个子区间[x_n,x_n+1], 每个子区间额外还取一个中点 $x_{k+1/2}$, 对每个区间计算辛普森公式。

$$
I=\frac{h}{6}[f(a)+4\sum_{k=0}^{n-1}{f(x_{k+1/2})}+2\sum_{k=1}^{n-1}{f(x_k)}+f(b)]\\
h=\frac{b-a}{n}\\
x_k=a+kh
$$

误差阶是$h^4$

## **龙贝格**算法
Romberg算法

### 理查德森(Richardson)外推算法

**理查德森(Richardson)外推算法**。

$$
T(h)=I+\alpha_1 h^2+\alpha_2 h^4+...
$$
2
$$
T(h/2)=I+\alpha_1 h^2/4+\alpha_2 h^4/16+...
$$

3
$$
S(h)=\frac{4T(h/2)-T(h)}{3}=I+\beta_1h^4+\beta_2h^6+...
$$
4

$$
S(h/2)=I+\beta_1(h/2)^4+\beta_2(h/2)^6+...
$$

5
$$
C(h)=\frac{16S(h/2)-S(h)}{15}=I+r_1h^6+r_2h^8
$$

6
$$
R(h)=\frac{64C(h/2)-C(h)}{63}=I+s_1h^8+...
$$


7 
$$
T_0(h)=T(h)\\
T_1(h)=S(h)\\
T_2(h)=C(h)\\
T_3(h)=R(h)\\
$$

8
$$
T_m(h)=\frac{4^m}{4^m-1}T_{m-1}(h/2)-\frac{1}{4^m-1}T_{m-1}(h)
$$


### 龙贝格-梯形积分

Romberg
$$
T_{2n}=\frac{1}{2}T_n+\frac{h}{2}\sum_{k=0}^{n-1}{f(x_{k+1/2})}\\
T_1=\frac{h}{2}[f(a)+f(b)]
$$

|k|h|总共采样点数|新增采样点|T |T|T|T|T|
|--------|-------|----|---------|---------|---------|---------|--------|---|
|0|b-a|a,b|2|$T_0^{(0)}$| ||||
|1|(b-a)/2|3|$a+h_i$|$T_0^{(1)}$|$T_1^{(1)}$||||
|2|(b-a)/4|5|$a+h_i,a+3h_i$|$T_0^{(2)}$|$T_1^{(2)}$|$T_2^{(2)}$|||
|3|(b-a)/8|9|$a+h_i,a+3h_i,a+5h_i,a+7h_i$|$T_0^{(3)}$|$T_1^{(3)}$|$T_2^{(3)}$|$T_3^{(3)}$||
|4|(b-a)/16|17|$a+h_i,a+3h_i,...,a+15h_i$|$T_0^{(4)}$|$T_1^{(4)}$|$T_2^{(4)}$|$T_3^{(4)}$|$T_4^{(4)}$|


上述公式中，
- $T_0^{(0)}$和2点公式等效。
- $T_1^{(1)}$和3点辛普森公式等效。
- $T_2^{(2)}$和5点公式等效？

### 龙贝格-simpson积分


### 龙贝格-自适应积分

## Gauss积分法



上面的牛顿积分公式是针对等间隔采样的。通过挑选采样点，可以提高代数精度。

对于n次多项式，可以得到2n+1次代数精度。

### Guass-lengendre

高斯-勒让德公式

适用于[-1,1]区间
$$
\int_{-1}^1{f(x)dx}=\sum_{k=0}^n{A_kf(x_k)}
$$




#### n=0

$$
\int_{-1}^1{f(x)dx}\approx2f(0)
$$



#### n=1

$$
\int_{-1}^1{f(x)dx}\approx f(-\frac{1}{\sqrt{3}})+f(\frac{1}{\sqrt{3}})
$$
#### n=2

$$
\int_{-1}^1{f(x)dx}\approx \frac{5}{9}f(-\frac{\sqrt{15}}{5})+\frac{8}{9}f(0)+\frac{5}{9}f(\frac{\sqrt{15}}{5})
$$

#### n=4

$$
x=[-0.9061798,-0.5384693,0,0.5384693,0.9061798]\\
A=[0.2369269,0.4786287,0.5688889,0.4786287,0.2369269]
$$




### 高斯-切比雪夫

高斯-切比雪夫公式

适用于[-1,1]区间， 可以计算奇异积分。

### 高斯-拉盖尔公式

高斯-拉盖尔公式

适用于[0,+inf)区间

###  高斯-埃尔米特

 高斯-埃尔米特公式

适用于(-inf,+inf)区间

### Kronrod积分法

Gauss积分法的缺点是误差估计较难，并且不具有递推性，当节点数增加时，无法直接利用之前计算过的数值。 Kronrod积分法，使得Gauss积分法能够递推，并给出了可靠地误差估计，但牺牲了精度，Kronrod积分法的精度约为3n/2。

**Python语言的SciPy科学计算库就直接支持Gauss-Kronrod积分法**，其底层是Fortran77编写的老牌数学库，速度相当快。默认算法精确到小数点后8位。

## 蒙特卡洛积分

Monte Carlo法是通过大量实验来求取随机变量近似值的一种常用的方法，在现代科学研究中经常用来求解一些建模困难的问题。

## misc

Numerical Methods

