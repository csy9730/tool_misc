# cubic spline

### cubic spline
$$
S_0^{``}(x_0)=0\\
S_{n-1}^{``}(x_n)=0
$$

已知n+1个数据节点，分成n个区间，在每个区间构造一个三次函数，共n段函数（S0~Sn-1）

$$
S_i(x)=a_i+b_i(x-x_i)+c_i(x-x_i)^2+d_i(x-x_i)^3
$$

多个三次函数：

$$
S_0(x)=a_0+b_0(x-x_0)+c_0(x-x_0)^2+d_0(x-x_0)^3\\
S_1(x)=a_1+b_1(x-x_1)+c_1(x-x_1)^2+d_1(x-x_1)^3\\
S_i(x)=a_i+b_i(x-x_i)+c_i(x-x_i)^2+d_i(x-x_i)^3\\
S_{n-1}(x)=a_{n-1}+b_{n-1}(x-x_{n-1})+c_{n-1}(x-x_{n-1})^2+d_{n-1}(x-x_{n-1})^3\\
$$

每段三次函数S(x)都有a,b,c,d四个系数，上述n个分段函数，共有4*n个系数（未知数）。因此，要想求解这4n个未知数，共需要4n个方程。


已知端点约束条件
$$
S_i(x_i)=y_i, i=0,1,n-1\\
S_i(x_{i+1})=y_{i+1},i=0,1,2,n-1\\
$$


已知导数连续条件
$$
S_i^`(x_{i+1})=S_{i+1}^`(x_{i+1}),i=0,1,n-2\\
$$

已知二阶导数连续条件
$$
S_i^{``}(x_{i+1})=S_{i+1}^{``}(x_{i+1}),i=0,1,n-2\\
$$

总共有n+n+(n-1)+(n-1)=4n-2个方程，还需要两个方程。
这两个方程通过边界条件给出。 


### 边界条件
- Clamped 紧压样条/完全三次样条，一阶导数条件
- second 二阶导数条件
- Natural 自然边界条件，二阶导数为0
- periodic 周期样条，左端点的微分等于右端点的微分，左端点的二次微分等于右端点的二次微分
- not a knot 无结三次样条

#### 完全三次样条
紧压样条(Clamped)，一阶导数条件.

$$
S^{`}_0(x_0)=A\\
S^{`}_{n-1}(x_n)=B\\
$$

#### 特定二阶导数 

二阶导数条件
$$
S^{``}_0(x_0)=A\\
S^{``}_{n-1}(x_n)=B\\
$$


#### Natural
自然边界条件，二阶导数为0
$$
S^{``}_0(x_0)=0\\
S^{``}_{n-1}(x_n)=0\\
$$

#### 周期三次样条
$$
S^{`}_{n-1}(x_n)=S^{`}_{0}(x_0)\\
S^{``}_{n-1}(x_n)=S^{``}_{0}(x_0)\\
$$

#### 无结三次样条
not a knot
$$
S^{```}_0(x_1)=S^{```}_1(x_1)\\
S^{```}_{n-2}(x_{n-1})=S^{```}_{n-1}(x_{n-1})\\
$$

## misc


### 长度计算


$$
y = ax^3+bx^2+cx+D\\
dy/dx = 3ax^2+2bx+c\\
dL = \sqrt{ dy^2+dx^2}\\

L(t) = \int_0^t{\sqrt{1+(3ax^2+2bx+c)^2}dx}
$$


### 自适应分段
根据屈曲点添加节点
```
0  [0,1/3, 2/3,1]
1 (a) [0,1/3, 2/3,1]
2 (a,b)  [0,(a+b)/2],[(a+b)/2, 1]
3 (a,b,c)  [0,b],[b,1]
```

#### 紧支撑
用最通俗的话来讲，紧支撑是这样的：

对于函数f(x)，如果自变量x在0附近的取值范围内，f(x)能取到值；而在此之外，f(x)取值为0。

那么这个函数f(x)就是紧支撑函数，而这个0附近的取值范围就叫做紧支撑集。

比如：在(-1,1)之间的高斯函数。


### 积分
样条函数 适合用来计算微分。用来计算积分，会有难以消除的偏置误差。

牛顿积分适合计算单点积分，如何计算多点积分？