# 贝塞尔曲线


### 贝塞尔曲线

以下的控制点P0,P1,...，可以是一维，二维，三维，任意高维。

#### 一阶贝塞尔曲线

平面一阶贝塞尔曲线(线段)：
$$
P_t=(1-t)P_0+tP_1\\
$$

##### 二阶贝塞尔曲线

平面二阶贝塞尔曲线(抛物线)：
$$
B(t)=(1-t)P_0^{`}+tP_1^{`}\\
P_t=(1-t)^2P_0+2t(1-t)P_1+t^2P_2
$$

三顶点P0、P1、P2三点定义的一条二次Bezier曲线

$$
y = (1-t)^2Y_0+2t(1-t)Y_1+t^2Y_2\\
= (1-2t+t^2)Y_0+(2t-2t^2)Y_1+t^2Y_2\\
= (Y_0-2Y_1+Y_2)t^2+(2Y_1-2Y_0)t+Y_0\\
$$





#### 3阶贝塞尔曲线
P0、P1、P2、P3四个点在平面或在三维空间中定义了三次方贝兹曲线。曲线起始于P0走向P1，并从P2的方向来到P3。一般不会经过P1或P2；这两个点只是在那里提供方向资讯。P0和P1之间的间距，决定了曲线在转而趋进P3之前，走向P2方向的“长度有多长”。

$$
B(t)=(1-t)P_0^{``}+tP_1^{``}\\
P_t=(1-t)^3P_0+3t(1-t)^2P_1+3t^2(1-t)P_2+t^3P_3\\
$$

按t展开：
$$
= (1-3t+3t^2-t^3)P_0+3t(1-2t+t^2)P_1+3t^2(1-t)P_2+t^3P_3\\
= (-P_0+3P_1-3P_2+P_3)t^3+(3P_0-6P_1+3P_2)t^2+(-3P_0+3P_1)t+P_0
$$


如果$P_0=P_1$
$$
P_t=(1-t)^3P_0+3t(1-t)P_1+ t^3P_3\\
$$
#### N阶贝塞尔曲线

N+1个点可以确定一条N阶贝塞尔曲线

#### 1

### 递推计算公式


由四个控制点定义的三次Bezier曲线P_0^3可被定义为分别由(P0,P1,P2)和(P1,P2,P3)确定的二条二次Bezier曲线的线性组合，由(N+1)个控制点P_i(i=0,1,...,N)定义的N次Bezier曲线, P_N可被定义为分别由前、后N个控制点定义的两条(N-1)次Bezier曲线P_0^(n-1)与P_1^(n-1)的线性组合：

$$
P_0^N=(1-t)P_0^{N-1}+tP_1^{N-1}, 0<=t<=1
$$

由此得到Bezier曲线的递推计算公式


$$
P_i^k=\begin{cases} P_i & k=0\\
(1-t)P_i^{k-1}+tP_{i+1}^{k-1} & k=1,2...N, i=0,1,...N-k
\end{cases}
$$

这就是这就是de Casteljau算法，可以简单阐述三阶贝塞尔曲线原理。
#### 伯恩斯坦多项式
伯恩斯坦多项式 Bernstein polynomials

$$
B_{n,i}(u)=C_i^nu^i(1-u)^{n-i}\\
C_i^n=\frac{n!}{i!(n-i)!}
$$

### 贝塞尔曲线 公式

P_i 是固定的控制点。
$$
P(t)=\sum_{i=0}^n{P_iB_{i,n}(t)} \\
B_{i,n}(t)=C_n^it^i(1-t)^{n-i}=\frac{n!}{i!(n-i)!}t^i(1-t)^{n-i}
$$

#### 求导公式

$$
\frac{d}{dt}B_{n,i}(t)=\frac{d}{dt}(\frac{n!}{i!(n-i)!}t^i(1-t)^{n-i})\\
=\frac{n!}{i!(n-i)!}(it^{i-1}(1-t)^{n-i}-t^i(1-t)^{n-i-1}(n-i))\\
=\frac{n!}{i!(n-i)!}(i-tn)t^{i-1}(1-t)^{n-i-1}\\
=n\frac{(n-1)!}{i!(n-i)!}(i-tn)t^{i-1}(1-t)^{n-i-1}\\
= n(B_{n-1,i-1}(t)-B_{n-1,i}(t))
$$



导数还是贝塞尔曲线, 只不过是控制点是原来控制点的组合而已.



以此类推:贝塞尔曲线的导数还是贝塞尔曲线.

### 性质

  1 各项系数之和为1.
这个很好理解,因为是系数是二项式的展开(t+(1-t))^n = (1)^n非负性. 好理解, 二项式的展开啊

2 对称性
第i项系数和倒数第i项系数相同, 从二项式的展开来思考,这个也好理解  

3 [递归性](https://www.zhihu.com/search?q=递归性&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1184466425})
递归性指其系数满足下式：

 凸包性质
贝塞尔曲线始终会在**包含了所有控制点的最小凸多边形**中, 不是按照控制点的顺序围成的[最小多边形](https://www.zhihu.com/search?q=最小多边形&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1184466425}). 这点大家一定注意.　这一点的是很关键的，也就是说可以通过控制点的凸包来限制[规划曲线](https://www.zhihu.com/search?q=规划曲线&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A1184466425})的范围，在路径规划是很需要的一个性质．

５端点性质
第一个控制点和最后一个控制点，恰好是曲线的起始点和终点．这一点可以套用二项式展开来理解，ｔ＝１或者０的时候，相乘二项式的系数，出了初始点或者末尾点，其余的都是０．

### 仿射变换
对贝塞尔曲线做仿射变换，我们可以通过先对控制点做仿射变换，然后利用变换后的控制点来得到新的曲线，这个曲线和直接对曲线做仿射变换得到的结果是一样的。

但是需要注意，投影变换不能这么操作。
### 升阶操作
所谓升阶操作，就是比如我们原本由 n+1 个控制点得到一个 n 阶贝塞尔曲线，我们可以把它变成是 n+2 个新的控制点并且得到 n+1 阶的贝塞尔曲线，这两个曲线一模一样。


$$
B_i^n(t)=(1-\frac{i}{n+1})B_i^{n+1}(t)+\frac{i+1}{n+1}B_{i+1}^{n+1}(t)
$$

代入公式
$$
P(t)=B_0^{n+1}(t)P_0+B_1^{n+1}(t)(\frac{1}{n+1}P_0+\frac{n}{n+1}P_1)
+B_2^{n+1}(t)(\frac{2}{n+1}P_1+\frac{n-1}{n+1}P_2)+...
+B_i^{n+1}(t)(\frac{i}{n+1}P_{i-1}+\frac{n+1-i}{n+1}P_i)+...
+B_{n+1}^{n+1}(t)(P_n)
$$


升阶操作的好处在于可以增加灵活性，例如我们原本有一个二阶的贝塞尔曲线，想要改变曲线形状只能修改三个顶点的位置。但是通过升阶，把它变成三阶的四阶的乃至更高阶的，我们就可以通过更多的顶点来调整这个曲线。
### 降阶操作
降阶的目的是寻找一组新的控制点定义的曲线，使得误差最小。
### 逐段的贝塞尔曲线（Piecewise Bezier Curves）
我们看看贝塞尔曲线存在的一些问题，如下图一个十阶的贝塞尔曲线

这里会存在一些问题：

首先二阶三阶的贝塞尔曲线我们很容易通过控制点就想象出曲线的大致形状，但是当控制点很多的时候，我们很难想象出曲线大致的形状。
其次我们无法做到只修改曲线的某一部分，因为只要动一个控制点，整个曲线都会跟着发生变换。
高阶的贝塞尔曲线往往会导致拐来拐去的，导致并不光滑，但是例如飞机汽车的表面都是很光滑的。


因此在CAD的应用中，通常不鼓励使用高阶的贝塞尔曲线，而是使用低阶贝塞尔曲线（通常用四阶的）相连


### 连续性

几何连续性（Geometric continuity）的概念。

所谓几何连续性的概念，就是导数的方向一样，我们即可认为是连续的


如果保证两段贝塞尔拼接曲线的曲率连续呢？控制点要怎么排布呢？

要求连接处的邻域3个控制点共线。
## misc



“贝赛尔”工具在photoshop中叫“钢笔工具”；在CorelDraw中翻译成“贝赛尔工具”；而在Fireworks中叫“画笔”。它是用来“画线”造型的一种专业工具。当然还有很多工具也可以完成画线的工作

一些看似简单的曲线（如圆）无法以贝塞尔曲线精确的描述，或分段成贝塞尔曲线（虽然当每个内部控制点对单位圆上的外部控制点水平或垂直的的距离为时，分成四段的贝兹曲线，可以小于千分之一的最大半径误差近似于圆）。

### 子曲线
一条曲线可在任意点切割成两条或任意多条子曲线，每一条子曲线仍是贝塞尔曲线。


$$
P_t=(1-t/2)^2P_0+2t/2(1-t/2)P_1+(t/2)^2P_2\\
4P_t=(2-t)^2P_0+2t(2-t)P_1+t^2P_2\\
4P_t=(2-t)^2P_0+2t(2-t)P_1+t^2P_2\\
2-t = 1+1-t
$$


### matrix


转换成矩阵形式

$$
\begin{pmatrix}
B_1(t)\\
B_2(t)\\
B_3(t)\\
B_4(t)\\
\end{pmatrix}
= \begin{pmatrix}
1 & -3 & 3 & -1\\
0 & 3 & -6 & 3\\
0 & 0 & 3 & -3\\
0 & 0 & 0 & 1\\
\end{pmatrix}
\begin{pmatrix}
1\\
t\\
t^2\\
t^3\\
\end{pmatrix}
$$



$$
P(t) = \begin{pmatrix}
x_0 & x_1 & x_2 & x_3\\
y_0 & y_1 & y_2 & y_3\\
\end{pmatrix} 
\begin{pmatrix}
B_1(t)\\
B_2(t)\\
B_3(t)\\
B_4(t)\\
\end{pmatrix}
= \begin{pmatrix}
x_0 & x_1 & x_2 & x_3\\
y_0 & y_1 & y_2 & y_3\\
\end{pmatrix} 
\begin{pmatrix}
1 & -3 & 3 & -1\\
0 & 3 & -6 & 3\\
0 & 0 & 3 & -3\\
0 & 0 & 0 & 1\\
\end{pmatrix}
\begin{pmatrix}
1\\
t\\
t^2\\
t^3\\
\end{pmatrix}
$$