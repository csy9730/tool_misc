# 牛顿迭代算法

## Newton-Raphson
Newton迭代法也称为切线法

求解方程$f(x)= 0$

对函数f(x)做一阶泰勒展开
$$
f(x) =f(x_k)+ f^`(x_k)(x-x_k) + \frac{f^{``}(x_k)}{2}(x-x_k)^2\\
\approx f(x_k)+ f^`(x_k)(x-x_k) 
$$

代入方程
$$
f(x) = 0 \\
f(x_k)+ f^`(x_k)(x-x_k) = 0\\
x = x_k - \frac{f(x_k)}{f^`(x_k)}
$$

#### 二阶收敛
牛顿法在靠近最优点处是二次收敛的。


#### 局部收敛性

若α是f(x)=0的一个单根, 
$$
f(α)=0, \\
f^`(α)≠0, \\
$$
引入 $ϕ(x)$
$$
ϕ^`(α)=0, \\
ϕ^{``}(α)=f^{``}(α)/f^`(α)
$$

则在根α附近Newton 法是局部收敛的, 并且是二阶收敛的

这就决定了牛顿迭代法的初值选取非常重要，只有在解的附近选初值才具有局部收敛性。

#### 高阶误差
推导牛顿法时，我们就舍弃了高阶项，舍弃这一部分产生的误差在迭代跨度稍微大一点的时候是不好忽略的。

我们将以上的性质称为牛顿法的局部收敛性。

#### 可能出现的问题

牛顿迭代法可能出现的问题
- 超出定义域
- 导数为0
- 振荡或发散
- 收敛过慢
#### 1

$$				
\phi(x) = x-f(x)/f^`(x)\\
\phi^`(x) = \frac{f(x)f^{``}(x))}{ |f^`(x)|^2}\\

$$


假定$x^*$ 是$f(x)=0$的一个单根，即$f( x^∗ ) = 0$ , $f^`(x^*)\neq 0$, 则有 $\varphi'(x^*)=0$ , 当x充分靠近 $x^*$  时，可使 $|\varphi'(x)|\leq L<1∣$ 成立，从而根据迭代法的局部收敛性定理可知，Newton迭代法在单根 $x^*$的邻近是收敛的。即有下面的Newton法局部收敛性定理。

#### 全局收敛性
然而，对于某些函数，初值离解很远也能收敛，这就要谈到全局收敛性了。

设f(x)在区间[a,b]上二阶导数存在，$x_0$ 是迭代初始值，且满足：

- $f(a)f(b)<0$
- $f^`(x)\neq 0,x\in(a,b)$
- $f^{''}(x) \neq 0, x\in(a,b)$ , $f^{``}(x)$ 不变号
- $f^{''}(x_0)f(x_0)>0, x_0\in(a,b)$ 

则Newton迭代公式收敛于$f(x)=0$在(a,b)内的惟一根$x^*$。

- 左右异号，存在过零点
- 单调增 或单调减
- 凹或凸
- 选取单边初始值，由于凹凸性质是确定的，只要确定过零点左边或右边即可。

实际上就是以下四种情况
- 单调增 + 凸函数
- 单调减 + 凸函数
- 单调增 + 凹函数
- 单调减 + 凹函数

#### 初值选取

做二阶泰勒展开

$$
f(x) =f(x_k)+ f^`(x_k)(x-x_k) + \frac{f^{``}(x_k)}{2}(x-x_k)^2\\
$$
做简单的代换，可以得到
$$
f(x_k)+ B(x-x_k) + A(x-x_k)^2=0\\
C+ Bu + Au^2=0\\
\Delta= B^2-4AC\\
u=\frac{-B\pm\sqrt{B^2-4AC}}{2A}\\
u=\frac{4AC}{2A(-B\pm\sqrt{B^2-4AC})}\\
u=\frac{-2C}{B\pm\sqrt{B^2-4AC}}
$$


选取初值，使$B^2 \gg 4AC$，
$$
u=\frac{-2C}{B\pm\sqrt{B^2-4AC}}\approx -C/B\\
x = u+x_k
$$

此时，牛顿法收敛较快
### demo
#### 使用牛顿法计算开平方
选取函数
$$
f(x) = x^2- C 
$$
求导
$$
f^`(x) = 2x
$$

牛顿迭代
$$
x_{k+1}= x_k-\frac{f(x_k)}{f^`(x_k)}\\
 = x_k-\frac{x_k^2-C}{2x_k}\\
 = \frac{x_k+C/x_k}{2}\\
$$

显然，导数恒大等于0，凸函数。


求解1的开方，收敛序列，[1.0833333333333333, 1.0032051282051282, 1.0000051200131073, 1.0000000000131073, 1.0]，

如果选取左侧方向的0.5作为初值，不符合条件，但也能跳到右侧方向，继续收敛。

可以发现，必定从上界往下逼近根。


对于全局收敛条件 $f^{''}(x_0)f(x_0)>0$ 条件， 似乎不太满足 。但是通过观察，发现只需要迭代一次，迭代值就从上界往下逼近，必定满足条件了。


#### 使用牛顿法计算开平方2
选取函数
$$
f(x) = x^2/C-1\\
f(x) = C/x^2-1\\
$$

求导
$$
f^`(x) = -2C/x^3\\
$$

牛顿迭代
$$
x_{k+1}= x - (C/x^2-1)/(-2C/x^3) \\
= x - (Cx-x^3)/(-2C) \\
= x + (Cx-x^3)/(2C) \\
=\frac{(3C-x_k^2)x_k}{2C}
$$

迭代函数导数可能超过1，导致发散？

#### 多重根
对于重根情况，牛顿法会退化成线性收敛。

需要使用多重根改进的牛顿法

#### 使用牛顿法计算求解对数函数
$$
f(x) = ln x - C
$$

定义域为 $(0, +\infin)$

2
$ f^`(x) = 1/x $
3
$$
x = x - (lnx - C)/(1/x) = x- xlnx+Cx
$$


```
C = 1
f = lambda x: x- x*log(x)+C*x

[0.9611918412977809, 1.960428869845841, 2.601169049780858, 2.7157219894809144, 2.7182806227648015, 2.7182818284587777, 2.718281828459045, 2.718281828459045, 2.718281828459045, 2.718281828459045, 2.718281828459045, 2.718281828459045, 2.718281828459045, 2.718281828459045, 2.718281828459045]
```

可以发现，必定从下界往上逼近根。

选取下界方向初值必定收敛，选取上界方向初值可能跳到下界方法然后收敛，也可能直接超出定义域，

## 牛顿最优化算法
对函数做二阶泰勒展开
$$
f(x) \approx f_k+\nabla f(x_k)(x-x_k) + (x-x_k)^T\nabla^2f(x_k)(x-x_k)/2
$$

两边求导
$$
\nabla f(x) \approx \nabla f(x_k)+ \nabla^2f(x_k)(x-x_k) \\
$$


极点方程
$$
\nabla f(x)=0 \\
$$
求解
$$
\Delta f(x_k)+ \Delta^2f(x_k)(x-x_k) = 0\\
 x = x_k-\Delta^2f^{-1}(x_k)* \Delta f(x_k)
$$

对于多元函数（向量），导数是Jacobi(雅克比)矩阵；二阶微分是Hessian（海森）矩阵。

### 阻尼牛顿法

牛顿下山法？

### LM法
牛顿法中 海森矩阵​可能是奇异、非正定等情况，为了解决这个情况，我们可以为Hessian矩阵加上一个 单位矩阵。

### ​拟牛顿法(Quasi-Newton Method)